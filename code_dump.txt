

===== ./index.php =====

<?php get_header(); ?>
<div class="site-content">
    <div class="max-w-7xl mx-auto px-4 py-8 overflow-hidden">
        <div class="flex flex-col md:flex-row">
            <div class="w-full md:w-2/3 md:pr-8 overflow-hidden">
                <h1 class="text-3xl font-bold mb-6">Available Courses</h1>
                
                <?php
                // Check if Tutor LMS is active
                if (function_exists('tutor_utils')) {
                    // Get Tutor LMS courses using WP_Query
                    $courses_query = new WP_Query([
                        'post_type' => 'courses',
                        'post_status' => 'publish',
                        'orderby' => 'post_date',
                        'order' => 'DESC',
                        'posts_per_page' => 12
                    ]);
                    
                    if ($courses_query->have_posts()) :
                        ?>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 overflow-hidden">
                            <?php while ($courses_query->have_posts()) : $courses_query->the_post(); ?>
                                <?php get_template_part('template-parts/content', 'course'); ?>
                            <?php endwhile; ?>
                        </div>
                        
                        <div class="mt-8">
                            <?php
                            // Pagination for courses
                            echo paginate_links(array(
                                'total' => $courses_query->max_num_pages,
                                'prev_text' => __('&laquo; Previous', 'yiontech-lms'),
                                'next_text' => __('Next &raquo;', 'yiontech-lms'),
                                'type' => 'list',
                                'before_page_number' => '<span class="mx-1">',
                                'after_page_number' => '</span>',
                            ));
                            ?>
                        </div>
                        <?php
                        wp_reset_postdata();
                    else :
                        ?>
                        <div class="bg-white rounded-lg shadow-md p-8 text-center">
                            <h2 class="text-2xl font-bold mb-4">No Courses Available</h2>
                            <p>Check back later for new courses.</p>
                        </div>
                        <?php
                    endif;
                } else {
                    // Fallback if Tutor LMS is not active
                    ?>
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-700">
                                    Tutor LMS plugin is not active. Please activate it to display courses.
                                </p>
                            </div>
                        </div>
                    </div>
                    <?php
                    // Display regular posts as fallback
                    if (have_posts()) :
                        ?>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 overflow-hidden">
                            <?php while (have_posts()) : the_post(); ?>
                                <?php get_template_part('template-parts/content', get_post_format()); ?>
                            <?php endwhile; ?>
                        </div>
                        
                        <div class="mt-8">
                            <?php the_posts_pagination(array(
                                'mid_size' => 2,
                                'prev_text' => __('&laquo; Previous', 'yiontech-lms'),
                                'next_text' => __('Next &raquo;', 'yiontech-lms'),
                            )); ?>
                        </div>
                        <?php
                    else :
                        get_template_part('template-parts/content', 'none');
                    endif;
                }
                ?>
            </div>
            <div class="w-full md:w-1/3 mt-8 md:mt-0">
                <?php get_sidebar(); ?>
            </div>
        </div>
    </div>
</div>
<?php get_footer(); ?>

===== ./admin/theme-settings.php =====

<?php
/**
 * Theme Settings Page
 *
 * @package Yiontech_LMS
 */

// Exit if accessed directly
if (!defined('ABSPATH')) {
    exit;
}

// Default theme settings
function yiontech_lms_get_default_settings() {
    return array(
        'enable_preloader' => 1,
        'site_icon' => '',
        'header_style' => 'default',
        'transparent_header' => 0,
        'sticky_header' => 1,
        'header_background_color' => '#1e40af',
        'sticky_header_background_color' => '#1e40af',
        'enable_back_to_top' => 1,
        'logo_upload' => '',
        'retina_logo_upload' => '',
        'header_buttons' => array(
            array(
                'text' => 'Login',
                'url' => '/login',
                'style' => 'outline',
                'show_desktop' => true,
                'show_mobile' => false,
            ),
            array(
                'text' => 'Enquire Now',
                'url' => '/contact',
                'style' => 'solid',
                'show_desktop' => true,
                'show_mobile' => true,
            ),
        ),
        'header_menu' => array(
            array('text' => 'Home', 'url' => '/'),
            array('text' => 'Courses', 'url' => '/courses'),
            array('text' => 'About', 'url' => '/about'),
            array('text' => 'Contact', 'url' => '/contact'),
        ),
        'footer_style' => 'default',
        'footer_content' => array(
            'column1' => array(
                'title' => 'About Us',
                'content' => 'A powerful learning management system designed for educators and students.',
            ),
            'column2' => array(
                'title' => 'Quick Links',
                'links' => array(
                    array('text' => 'Home', 'url' => '/'),
                    array('text' => 'Courses', 'url' => '/courses'),
                    array('text' => 'About', 'url' => '/about'),
                    array('text' => 'Contact', 'url' => '/contact'),
                ),
            ),
            'column3' => array(
                'title' => 'Company',
                'links' => array(
                    array('text' => 'About Us', 'url' => '/about'),
                    array('text' => 'Our Team', 'url' => '/team'),
                    array('text' => 'Careers', 'url' => '/careers'),
                    array('text' => 'Blog', 'url' => '/blog'),
                ),
            ),
            'column4' => array(
                'title' => 'User Portal',
                'links' => array(
                    array('text' => 'Login', 'url' => '/login'),
                    array('text' => 'Register', 'url' => '/register'),
                    array('text' => 'Dashboard', 'url' => '/dashboard'),
                    array('text' => 'Profile', 'url' => '/profile'),
                ),
            ),
            'column5' => array(
                'title' => 'Newsletter',
                'content' => 'Get the latest news and updates delivered right to your inbox.',
                'email' => 'info@yiontech.com',
                'phone' => '+1 (555) 123-4567',
            ),
        ),
        'copyright_text' => '&copy; ' . date('Y') . ' ' . get_bloginfo('name') . '. All rights reserved.',
        'footer_text_color' => '#ffffff',
        'footer_background_color' => '#111827',
        'copyright_background_color' => '#0f172a',
        'footer_padding' => array('top' => 48, 'bottom' => 48),
        'newsletter_enable' => 0,
        'newsletter_action_url' => '',
        'newsletter_method' => 'post',
        'newsletter_email_field' => 'email',
        'newsletter_hidden_fields' => '',
        'newsletter_success_message' => 'Thank you for subscribing!',
        'custom_css' => '',
        // Privacy Settings
        'enable_privacy_features' => 1,
        'privacy_policy_page' => 0,
        'terms_of_service_page' => 0,
        'cookie_consent_text' => 'We use cookies to ensure you get the best experience on our website. By continuing to use this site, you consent to our use of cookies.',
        'cookie_consent_button_text' => 'Accept',
        'cookie_consent_learn_more_text' => 'Learn More',
        'enable_data_export' => 1,
        'enable_account_deletion' => 1,
    );
}

// Get theme setting with default fallback
function yiontech_lms_get_theme_setting($key, $default = '') {
    $defaults = yiontech_lms_get_default_settings();
    $options = get_option('yiontech_lms_theme_settings', $defaults);
    
    // Debug: Log the options
    if (defined('WP_DEBUG') && WP_DEBUG) {
        error_log('yiontech_lms_theme_settings: ' . print_r($options, true));
    }
    
    // If key exists in options, return it
    if (isset($options[$key])) {
        return $options[$key];
    }
    
    // Otherwise, return default from defaults array
    if (isset($defaults[$key])) {
        return $defaults[$key];
    }
    
    // Finally, return the provided default
    return $default;
}

// Sanitize theme settings
function yiontech_lms_sanitize_settings($input) {
    // Get current settings to preserve values not being updated
    $current_options = get_option('yiontech_lms_theme_settings', yiontech_lms_get_default_settings());
    
    // Start with current options
    $output = $current_options;
    
    // Sanitize individual fields only if they exist in input
    if (isset($input['enable_preloader'])) {
        $output['enable_preloader'] = $input['enable_preloader'] ? 1 : 0;
    }
    
    if (isset($input['site_icon'])) {
        $output['site_icon'] = esc_url_raw($input['site_icon']);
    }
    
    if (isset($input['header_style'])) {
        $output['header_style'] = in_array($input['header_style'], array('default', 'minimal', 'centered')) ? $input['header_style'] : $current_options['header_style'];
    }
    
    if (isset($input['transparent_header'])) {
        $output['transparent_header'] = $input['transparent_header'] ? 1 : 0;
    }
    
    if (isset($input['sticky_header'])) {
        $output['sticky_header'] = $input['sticky_header'] ? 1 : 0;
    }
    
    if (isset($input['header_background_color'])) {
        $output['header_background_color'] = sanitize_hex_color($input['header_background_color']);
    }
    
    if (isset($input['sticky_header_background_color'])) {
        $output['sticky_header_background_color'] = sanitize_hex_color($input['sticky_header_background_color']);
    }
    
    if (isset($input['enable_back_to_top'])) {
        $output['enable_back_to_top'] = $input['enable_back_to_top'] ? 1 : 0;
    }
    
    if (isset($input['logo_upload'])) {
        $output['logo_upload'] = esc_url_raw($input['logo_upload']);
    }
    
    if (isset($input['retina_logo_upload'])) {
        $output['retina_logo_upload'] = esc_url_raw($input['retina_logo_upload']);
    }
    
    // Sanitize header buttons
    if (isset($input['header_buttons']) && is_array($input['header_buttons'])) {
        $output['header_buttons'] = array();
        foreach ($input['header_buttons'] as $button) {
            if (!empty($button['text']) && !empty($button['url'])) {
                $output['header_buttons'][] = array(
                    'text' => sanitize_text_field($button['text']),
                    'url' => esc_url_raw($button['url']),
                    'style' => isset($button['style']) && in_array($button['style'], array('solid', 'outline')) ? $button['style'] : 'solid',
                    'show_desktop' => isset($button['show_desktop']) ? 1 : 0,
                    'show_mobile' => isset($button['show_mobile']) ? 1 : 0,
                );
            }
        }
    }
    
    // Sanitize header menu
    if (isset($input['header_menu']) && is_array($input['header_menu'])) {
        $output['header_menu'] = array();
        foreach ($input['header_menu'] as $item) {
            if (!empty($item['text']) && !empty($item['url'])) {
                $output['header_menu'][] = array(
                    'text' => sanitize_text_field($item['text']),
                    'url' => esc_url_raw($item['url']),
                );
            }
        }
    }
    
    // Sanitize footer settings
    if (isset($input['footer_style'])) {
        $output['footer_style'] = in_array($input['footer_style'], array('default', 'minimal', 'centered')) ? $input['footer_style'] : $current_options['footer_style'];
    }
    
    if (isset($input['copyright_text'])) {
        $output['copyright_text'] = wp_kses_post($input['copyright_text']);
    }
    
    if (isset($input['footer_text_color'])) {
        $output['footer_text_color'] = sanitize_hex_color($input['footer_text_color']);
    }
    
    if (isset($input['footer_background_color'])) {
        $output['footer_background_color'] = sanitize_hex_color($input['footer_background_color']);
    }
    
    if (isset($input['copyright_background_color'])) {
        $output['copyright_background_color'] = sanitize_hex_color($input['copyright_background_color']);
    }
    
    // Sanitize footer padding
    if (isset($input['footer_padding']) && is_array($input['footer_padding'])) {
        $output['footer_padding'] = array(
            'top' => isset($input['footer_padding']['top']) ? absint($input['footer_padding']['top']) : $current_options['footer_padding']['top'],
            'bottom' => isset($input['footer_padding']['bottom']) ? absint($input['footer_padding']['bottom']) : $current_options['footer_padding']['bottom'],
        );
    }
    
    // Sanitize footer content
    if (isset($input['footer_content']) && is_array($input['footer_content'])) {
        // Column 1
        if (isset($input['footer_content']['column1'])) {
            $output['footer_content']['column1'] = array(
                'title' => isset($input['footer_content']['column1']['title']) ? sanitize_text_field($input['footer_content']['column1']['title']) : $current_options['footer_content']['column1']['title'],
                'content' => isset($input['footer_content']['column1']['content']) ? wp_kses_post($input['footer_content']['column1']['content']) : $current_options['footer_content']['column1']['content'],
            );
        }
        
        // Columns 2-4 with links
        for ($i = 2; $i <= 4; $i++) {
            $column_key = 'column' . $i;
            if (isset($input['footer_content'][$column_key]) && isset($input['footer_content'][$column_key]['links']) && is_array($input['footer_content'][$column_key]['links'])) {
                $output['footer_content'][$column_key] = array(
                    'title' => isset($input['footer_content'][$column_key]['title']) ? sanitize_text_field($input['footer_content'][$column_key]['title']) : $current_options['footer_content'][$column_key]['title'],
                    'links' => array(),
                );
                
                foreach ($input['footer_content'][$column_key]['links'] as $link) {
                    if (!empty($link['text']) && !empty($link['url'])) {
                        $output['footer_content'][$column_key]['links'][] = array(
                            'text' => sanitize_text_field($link['text']),
                            'url' => esc_url_raw($link['url']),
                        );
                    }
                }
            }
        }
        
        // Column 5
        if (isset($input['footer_content']['column5'])) {
            $output['footer_content']['column5'] = array(
                'title' => isset($input['footer_content']['column5']['title']) ? sanitize_text_field($input['footer_content']['column5']['title']) : $current_options['footer_content']['column5']['title'],
                'content' => isset($input['footer_content']['column5']['content']) ? wp_kses_post($input['footer_content']['column5']['content']) : $current_options['footer_content']['column5']['content'],
                'email' => isset($input['footer_content']['column5']['email']) ? sanitize_email($input['footer_content']['column5']['email']) : $current_options['footer_content']['column5']['email'],
                'phone' => isset($input['footer_content']['column5']['phone']) ? sanitize_text_field($input['footer_content']['column5']['phone']) : $current_options['footer_content']['column5']['phone'],
            );
        }
    }
    
    // Sanitize newsletter settings
    if (isset($input['newsletter_enable'])) {
        $output['newsletter_enable'] = $input['newsletter_enable'] ? 1 : 0;
    }
    
    if (isset($input['newsletter_action_url'])) {
        $output['newsletter_action_url'] = esc_url_raw($input['newsletter_action_url']);
    }
    
    if (isset($input['newsletter_method'])) {
        $output['newsletter_method'] = in_array($input['newsletter_method'], array('post', 'get')) ? $input['newsletter_method'] : $current_options['newsletter_method'];
    }
    
    if (isset($input['newsletter_email_field'])) {
        $output['newsletter_email_field'] = sanitize_text_field($input['newsletter_email_field']);
    }
    
    if (isset($input['newsletter_hidden_fields'])) {
        $output['newsletter_hidden_fields'] = sanitize_textarea_field($input['newsletter_hidden_fields']);
    }
    
    if (isset($input['newsletter_success_message'])) {
        $output['newsletter_success_message'] = sanitize_textarea_field($input['newsletter_success_message']);
    }
    
    // Sanitize custom CSS
    if (isset($input['custom_css'])) {
        $output['custom_css'] = wp_strip_all_tags($input['custom_css']);
    }
    
    // Sanitize privacy settings
    if (isset($input['enable_privacy_features'])) {
        $output['enable_privacy_features'] = $input['enable_privacy_features'] ? 1 : 0;
    }
    
    if (isset($input['privacy_policy_page'])) {
        $output['privacy_policy_page'] = absint($input['privacy_policy_page']);
    }
    
    if (isset($input['terms_of_service_page'])) {
        $output['terms_of_service_page'] = absint($input['terms_of_service_page']);
    }
    
    if (isset($input['cookie_consent_text'])) {
        $output['cookie_consent_text'] = wp_kses_post($input['cookie_consent_text']);
    }
    
    if (isset($input['cookie_consent_button_text'])) {
        $output['cookie_consent_button_text'] = sanitize_text_field($input['cookie_consent_button_text']);
    }
    
    if (isset($input['cookie_consent_learn_more_text'])) {
        $output['cookie_consent_learn_more_text'] = sanitize_text_field($input['cookie_consent_learn_more_text']);
    }
    
    if (isset($input['enable_data_export'])) {
        $output['enable_data_export'] = $input['enable_data_export'] ? 1 : 0;
    }
    
    if (isset($input['enable_account_deletion'])) {
        $output['enable_account_deletion'] = $input['enable_account_deletion'] ? 1 : 0;
    }
    
    return $output;
}

// Register settings, sections, and fields
function yiontech_lms_theme_settings_init() {
    // Register settings with sanitization
    register_setting('yiontech_lms_theme_settings', 'yiontech_lms_theme_settings', 'yiontech_lms_sanitize_settings');

    // General section
    add_settings_section(
        'yiontech_lms_general_section',
        'General',
        'yiontech_lms_general_section_callback',
        'yiontech_lms_theme_settings'
    );

    // Preloader
    add_settings_field(
        'enable_preloader',
        'Enable Preloader',
        'yiontech_lms_checkbox_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_general_section',
        array(
            'id' => 'enable_preloader',
            'name' => 'yiontech_lms_theme_settings[enable_preloader]',
            'description' => 'Enable preloader for the site',
        )
    );

    // Site Icon
    add_settings_field(
        'site_icon',
        'Site Icon (Favicon)',
        'yiontech_lms_media_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_general_section',
        array(
            'id' => 'site_icon',
            'name' => 'yiontech_lms_theme_settings[site_icon]',
            'description' => 'Upload site icon for browser tab',
        )
    );

    // Enable Back to Top (moved to general section)
    add_settings_field(
        'enable_back_to_top',
        'Enable Back to Top Button',
        'yiontech_lms_checkbox_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_general_section',
        array(
            'id' => 'enable_back_to_top',
            'name' => 'yiontech_lms_theme_settings[enable_back_to_top]',
            'description' => 'Enable back to top button',
        )
    );

    // Header section
    add_settings_section(
        'yiontech_lms_header_section',
        'Header',
        'yiontech_lms_header_section_callback',
        'yiontech_lms_theme_settings'
    );

    // Header Style
    add_settings_field(
        'header_style',
        'Select Header Style',
        'yiontech_lms_select_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'header_style',
            'name' => 'yiontech_lms_theme_settings[header_style]',
            'options' => array(
                'default' => 'Default Header',
                'minimal' => 'Minimal Header',
                'centered' => 'Centered Logo Header',
            ),
            'description' => 'Choose header style',
        )
    );

    // Transparent Header
    add_settings_field(
        'transparent_header',
        'Transparent Header',
        'yiontech_lms_checkbox_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'transparent_header',
            'name' => 'yiontech_lms_theme_settings[transparent_header]',
            'description' => 'Make header transparent on homepage',
        )
    );

    // Sticky Header
    add_settings_field(
        'sticky_header',
        'Sticky Header On/Off',
        'yiontech_lms_checkbox_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'sticky_header',
            'name' => 'yiontech_lms_theme_settings[sticky_header]',
            'description' => 'Enable sticky header',
        )
    );

    // Header Background Color
    add_settings_field(
        'header_background_color',
        'Header Background Color',
        'yiontech_lms_color_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'header_background_color',
            'name' => 'yiontech_lms_theme_settings[header_background_color]',
            'description' => 'Choose header background color',
        )
    );

    // Sticky Header Background Color
    add_settings_field(
        'sticky_header_background_color',
        'Sticky Header Background Color',
        'yiontech_lms_color_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'sticky_header_background_color',
            'name' => 'yiontech_lms_theme_settings[sticky_header_background_color]',
            'description' => 'Choose sticky header background color',
        )
    );

    // Logo Upload
    add_settings_field(
        'logo_upload',
        'Logo Upload',
        'yiontech_lms_media_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'logo_upload',
            'name' => 'yiontech_lms_theme_settings[logo_upload]',
            'description' => 'Upload your logo',
        )
    );

    // Retina Logo Upload
    add_settings_field(
        'retina_logo_upload',
        'Retina Logo Upload @2x',
        'yiontech_lms_media_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'retina_logo_upload',
            'name' => 'yiontech_lms_theme_settings[retina_logo_upload]',
            'description' => 'Upload retina version of your logo (2x size)',
        )
    );

    // Header Buttons
    add_settings_field(
        'header_buttons',
        'Header Buttons',
        'yiontech_lms_header_buttons_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'header_buttons',
            'name' => 'yiontech_lms_theme_settings[header_buttons]',
            'description' => 'Configure header buttons',
        )
    );

    // Header Menu
    add_settings_field(
        'header_menu',
        'Header Menu',
        'yiontech_lms_menu_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_header_section',
        array(
            'id' => 'header_menu',
            'name' => 'yiontech_lms_theme_settings[header_menu]',
            'description' => 'Configure header menu items',
        )
    );

    // Footer section
    add_settings_section(
        'yiontech_lms_footer_section',
        'Footer',
        'yiontech_lms_footer_section_callback',
        'yiontech_lms_theme_settings'
    );

    // Footer Style
    add_settings_field(
        'footer_style',
        'Select Footer Style',
        'yiontech_lms_select_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_footer_section',
        array(
            'id' => 'footer_style',
            'name' => 'yiontech_lms_theme_settings[footer_style]',
            'options' => array(
                'default' => 'Default Footer',
                'minimal' => 'Minimal Footer',
                'centered' => 'Centered Footer',
            ),
            'description' => 'Choose footer style',
        )
    );

    // Footer Content
    add_settings_field(
        'footer_content',
        'Footer Content',
        'yiontech_lms_footer_content_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_footer_section',
        array(
            'id' => 'footer_content',
            'name' => 'yiontech_lms_theme_settings[footer_content]',
            'description' => 'Configure footer columns and content',
        )
    );

    // Copyright Text
    add_settings_field(
        'copyright_text',
        'Copyright Text',
        'yiontech_lms_textarea_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_footer_section',
        array(
            'id' => 'copyright_text',
            'name' => 'yiontech_lms_theme_settings[copyright_text]',
            'description' => 'Enter copyright text',
        )
    );

    // Footer Text Color
    add_settings_field(
        'footer_text_color',
        'Footer Text Color',
        'yiontech_lms_color_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_footer_section',
        array(
            'id' => 'footer_text_color',
            'name' => 'yiontech_lms_theme_settings[footer_text_color]',
            'description' => 'Choose footer text color',
        )
    );

    // Footer Background Color
    add_settings_field(
        'footer_background_color',
        'Footer Background Color',
        'yiontech_lms_color_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_footer_section',
        array(
            'id' => 'footer_background_color',
            'name' => 'yiontech_lms_theme_settings[footer_background_color]',
            'description' => 'Choose footer background color',
        )
    );

    // Copyright Background Color
    add_settings_field(
        'copyright_background_color',
        'Copyright Background Color',
        'yiontech_lms_color_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_footer_section',
        array(
            'id' => 'copyright_background_color',
            'name' => 'yiontech_lms_theme_settings[copyright_background_color]',
            'description' => 'Choose copyright section background color',
        )
    );

    // Footer Padding
    add_settings_field(
        'footer_padding',
        'Padding Top/Bottom',
        'yiontech_lms_spacing_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_footer_section',
        array(
            'id' => 'footer_padding',
            'name' => 'yiontech_lms_theme_settings[footer_padding]',
            'description' => 'Set footer padding top and bottom (in pixels)',
        )
    );

    // Newsletter section
    add_settings_section(
        'yiontech_lms_newsletter_section',
        'Newsletter',
        'yiontech_lms_newsletter_section_callback',
        'yiontech_lms_theme_settings'
    );

    // Newsletter Enable
    add_settings_field(
        'newsletter_enable',
        'Enable Newsletter',
        'yiontech_lms_checkbox_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_newsletter_section',
        array(
            'id' => 'newsletter_enable',
            'name' => 'yiontech_lms_theme_settings[newsletter_enable]',
            'description' => 'Enable newsletter subscription',
        )
    );

    // Newsletter Action URL
    add_settings_field(
        'newsletter_action_url',
        'Newsletter Action URL',
        'yiontech_lms_text_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_newsletter_section',
        array(
            'id' => 'newsletter_action_url',
            'name' => 'yiontech_lms_theme_settings[newsletter_action_url]',
            'description' => 'Enter the form action URL (e.g., Mailchimp, ConvertKit, etc.)',
        )
    );

    // Newsletter Method
    add_settings_field(
        'newsletter_method',
        'Form Method',
        'yiontech_lms_select_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_newsletter_section',
        array(
            'id' => 'newsletter_method',
            'name' => 'yiontech_lms_theme_settings[newsletter_method]',
            'options' => array(
                'post' => 'POST',
                'get' => 'GET',
            ),
            'description' => 'Choose form submission method',
        )
    );

    // Newsletter Email Field Name
    add_settings_field(
        'newsletter_email_field',
        'Email Field Name',
        'yiontech_lms_text_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_newsletter_section',
        array(
            'id' => 'newsletter_email_field',
            'name' => 'yiontech_lms_theme_settings[newsletter_email_field]',
            'description' => 'Enter the name attribute for the email field (e.g., EMAIL, email, etc.)',
        )
    );

    // Newsletter Hidden Fields
    add_settings_field(
        'newsletter_hidden_fields',
        'Hidden Fields',
        'yiontech_lms_textarea_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_newsletter_section',
        array(
            'id' => 'newsletter_hidden_fields',
            'name' => 'yiontech_lms_theme_settings[newsletter_hidden_fields]',
            'description' => 'Enter any hidden fields required by your newsletter service (one per line in format: name=value)',
            'rows' => 5,
        )
    );

    // Newsletter Success Message
    add_settings_field(
        'newsletter_success_message',
        'Success Message',
        'yiontech_lms_textarea_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_newsletter_section',
        array(
            'id' => 'newsletter_success_message',
            'name' => 'yiontech_lms_theme_settings[newsletter_success_message]',
            'description' => 'Enter the message to show after successful subscription',
            'rows' => 3,
        )
    );

    // Privacy section
    add_settings_section(
        'yiontech_lms_privacy_section',
        'Privacy Settings',
        'yiontech_lms_privacy_section_callback',
        'yiontech_lms_theme_settings'
    );

    // Enable Privacy Features
    add_settings_field(
        'enable_privacy_features',
        'Enable Privacy Features',
        'yiontech_lms_checkbox_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_privacy_section',
        array(
            'id' => 'enable_privacy_features',
            'name' => 'yiontech_lms_theme_settings[enable_privacy_features]',
            'description' => 'Enable privacy features including cookie consent and data protection',
        )
    );

    // Privacy Policy Page
    add_settings_field(
        'privacy_policy_page',
        'Privacy Policy Page',
        'yiontech_lms_page_select_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_privacy_section',
        array(
            'id' => 'privacy_policy_page',
            'name' => 'yiontech_lms_theme_settings[privacy_policy_page]',
            'description' => 'Select your privacy policy page',
        )
    );

    // Terms of Service Page
    add_settings_field(
        'terms_of_service_page',
        'Terms of Service Page',
        'yiontech_lms_page_select_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_privacy_section',
        array(
            'id' => 'terms_of_service_page',
            'name' => 'yiontech_lms_theme_settings[terms_of_service_page]',
            'description' => 'Select your terms of service page',
        )
    );

    // Cookie Consent Text
    add_settings_field(
        'cookie_consent_text',
        'Cookie Consent Text',
        'yiontech_lms_textarea_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_privacy_section',
        array(
            'id' => 'cookie_consent_text',
            'name' => 'yiontech_lms_theme_settings[cookie_consent_text]',
            'description' => 'Enter the text to display in the cookie consent banner',
            'rows' => 3,
        )
    );

    // Cookie Consent Button Text
    add_settings_field(
        'cookie_consent_button_text',
        'Cookie Consent Button Text',
        'yiontech_lms_text_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_privacy_section',
        array(
            'id' => 'cookie_consent_button_text',
            'name' => 'yiontech_lms_theme_settings[cookie_consent_button_text]',
            'description' => 'Enter the text for the cookie consent accept button',
        )
    );

    // Cookie Consent Learn More Text
    add_settings_field(
        'cookie_consent_learn_more_text',
        'Cookie Consent Learn More Text',
        'yiontech_lms_text_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_privacy_section',
        array(
            'id' => 'cookie_consent_learn_more_text',
            'name' => 'yiontech_lms_theme_settings[cookie_consent_learn_more_text]',
            'description' => 'Enter the text for the cookie consent learn more link',
        )
    );

    // Enable Data Export
    add_settings_field(
        'enable_data_export',
        'Enable Data Export',
        'yiontech_lms_checkbox_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_privacy_section',
        array(
            'id' => 'enable_data_export',
            'name' => 'yiontech_lms_theme_settings[enable_data_export]',
            'description' => 'Allow users to export their data from their profile page',
        )
    );

    // Enable Account Deletion
    add_settings_field(
        'enable_account_deletion',
        'Enable Account Deletion',
        'yiontech_lms_checkbox_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_privacy_section',
        array(
            'id' => 'enable_account_deletion',
            'name' => 'yiontech_lms_theme_settings[enable_account_deletion]',
            'description' => 'Allow users to delete their account from their profile page',
        )
    );

    // CSS Editor section
    add_settings_section(
        'yiontech_lms_css_editor_section',
        'CSS Editor',
        'yiontech_lms_css_editor_section_callback',
        'yiontech_lms_theme_settings'
    );

    // Custom CSS
    add_settings_field(
        'custom_css',
        'Custom CSS',
        'yiontech_lms_textarea_field',
        'yiontech_lms_theme_settings',
        'yiontech_lms_css_editor_section',
        array(
            'id' => 'custom_css',
            'name' => 'yiontech_lms_theme_settings[custom_css]',
            'description' => 'Add your custom CSS here',
            'rows' => 20,
        )
    );
}
add_action('admin_init', 'yiontech_lms_theme_settings_init');

// Enqueue admin scripts and styles
function yiontech_lms_admin_enqueue_scripts($hook) {
    // Only load on theme settings pages
    if (strpos($hook, 'theme-settings') === false) {
        return;
    }
    
    // Enqueue WordPress media scripts
    wp_enqueue_media();
    
    // Enqueue custom admin script
    wp_enqueue_script(
        'yiontech-lms-admin',
        get_template_directory_uri() . '/js/admin.js',
        array('jquery', 'wp-color-picker'),
        '1.0.0',
        true
    );
    
    // Enqueue custom admin styles
    wp_enqueue_style(
        'yiontech-lms-admin',
        get_template_directory_uri() . '/css/admin.css',
        array('wp-color-picker'),
        '1.0.0'
    );
    
    // Pass data to our script
    wp_localize_script('yiontech-lms-admin', 'yiontech_lms_admin', array(
        'ajax_url' => admin_url('admin-ajax.php'),
        'nonce' => wp_create_nonce('yiontech_lms_admin_nonce'),
    ));
}
add_action('admin_enqueue_scripts', 'yiontech_lms_admin_enqueue_scripts');

// Add theme settings page to admin menu
function yiontech_lms_add_theme_settings_page() {
    add_menu_page(
        'Yiontech LMS Settings',
        'Yiontech LMS',
        'manage_options',
        'theme-settings-general',
        'yiontech_lms_general_settings_page',
        'dashicons-admin-settings',
        5 // Position below Posts
    );
    
    // Add submenus
    add_submenu_page(
        'theme-settings-general',
        'General Settings',
        'General',
        'manage_options',
        'theme-settings-general',
        'yiontech_lms_general_settings_page'
    );
    
    add_submenu_page(
        'theme-settings-general',
        'Header Settings',
        'Header',
        'manage_options',
        'theme-settings-header',
        'yiontech_lms_header_settings_page'
    );
    
    add_submenu_page(
        'theme-settings-general',
        'Footer Settings',
        'Footer',
        'manage_options',
        'theme-settings-footer',
        'yiontech_lms_footer_settings_page'
    );
    
    add_submenu_page(
        'theme-settings-general',
        'Newsletter Settings',
        'Newsletter',
        'manage_options',
        'theme-settings-newsletter',
        'yiontech_lms_newsletter_settings_page'
    );
    
    add_submenu_page(
        'theme-settings-general',
        'Privacy Settings',
        'Privacy',
        'manage_options',
        'theme-settings-privacy',
        'yiontech_lms_privacy_settings_page'
    );
    
    add_submenu_page(
        'theme-settings-general',
        'CSS Editor',
        'CSS Editor',
        'manage_options',
        'theme-settings-css',
        'yiontech_lms_css_settings_page'
    );
}
add_action('admin_menu', 'yiontech_lms_add_theme_settings_page');

// Helper function to output hidden fields for preserving settings
function yiontech_lms_output_hidden_fields($exclude_fields = array()) {
    // Get all current settings
    $all_settings = get_option('yiontech_lms_theme_settings', yiontech_lms_get_default_settings());
    
    // Output hidden fields for all settings not in the exclude list
    foreach ($all_settings as $key => $value) {
        if (!in_array($key, $exclude_fields)) {
            if (is_array($value)) {
                // For array values, encode as JSON
                echo '<input type="hidden" name="yiontech_lms_theme_settings[' . esc_attr($key) . ']" value="' . esc_attr(json_encode($value)) . '" />';
            } else {
                // For scalar values
                echo '<input type="hidden" name="yiontech_lms_theme_settings[' . esc_attr($key) . ']" value="' . esc_attr($value) . '" />';
            }
        }
    }
}

// General settings page
function yiontech_lms_general_settings_page() {
    ?>
    <div class="wrap">
        <h1>Yiontech LMS Theme Settings</h1>
        <div class="settings-container">
            <form method="post" action="options.php">
                <?php
                settings_fields('yiontech_lms_theme_settings');
                
                // Output hidden fields for all settings not in this section
                yiontech_lms_output_hidden_fields(array('enable_preloader', 'site_icon', 'enable_back_to_top'));
                
                yiontech_lms_output_settings_section('yiontech_lms_general_section');
                submit_button();
                ?>
            </form>
        </div>
    </div>
    <?php
}

// Header settings page
function yiontech_lms_header_settings_page() {
    ?>
    <div class="wrap">
        <h1>Header Settings</h1>
        <div class="settings-container">
            <form method="post" action="options.php">
                <?php
                settings_fields('yiontech_lms_theme_settings');
                
                // Output hidden fields for all settings not in this section
                yiontech_lms_output_hidden_fields(array('header_style', 'transparent_header', 'sticky_header', 'header_background_color', 'sticky_header_background_color', 'logo_upload', 'retina_logo_upload', 'header_buttons', 'header_menu'));
                
                yiontech_lms_output_settings_section('yiontech_lms_header_section');
                submit_button();
                ?>
            </form>
        </div>
    </div>
    <?php
}

// Footer settings page
function yiontech_lms_footer_settings_page() {
    ?>
    <div class="wrap">
        <h1>Footer Settings</h1>
        <div class="settings-container">
            <form method="post" action="options.php">
                <?php
                settings_fields('yiontech_lms_theme_settings');
                
                // Output hidden fields for all settings not in this section
                yiontech_lms_output_hidden_fields(array('footer_style', 'footer_content', 'copyright_text', 'footer_text_color', 'footer_background_color', 'copyright_background_color', 'footer_padding'));
                
                yiontech_lms_output_settings_section('yiontech_lms_footer_section');
                submit_button();
                ?>
            </form>
        </div>
    </div>
    <?php
}

// Newsletter settings page
function yiontech_lms_newsletter_settings_page() {
    ?>
    <div class="wrap">
        <h1>Newsletter Settings</h1>
        <div class="settings-container">
            <form method="post" action="options.php">
                <?php
                settings_fields('yiontech_lms_theme_settings');
                
                // Output hidden fields for all settings not in this section
                yiontech_lms_output_hidden_fields(array('newsletter_enable', 'newsletter_action_url', 'newsletter_method', 'newsletter_email_field', 'newsletter_hidden_fields', 'newsletter_success_message'));
                
                yiontech_lms_output_settings_section('yiontech_lms_newsletter_section');
                submit_button();
                ?>
            </form>
        </div>
    </div>
    <?php
}

// Privacy settings page
function yiontech_lms_privacy_settings_page() {
    ?>
    <div class="wrap">
        <h1>Privacy Settings</h1>
        <div class="settings-container">
            <form method="post" action="options.php">
                <?php
                settings_fields('yiontech_lms_theme_settings');
                
                // Output hidden fields for all settings not in this section
                yiontech_lms_output_hidden_fields(array('enable_privacy_features', 'privacy_policy_page', 'terms_of_service_page', 'cookie_consent_text', 'cookie_consent_button_text', 'cookie_consent_learn_more_text', 'enable_data_export', 'enable_account_deletion'));
                
                yiontech_lms_output_settings_section('yiontech_lms_privacy_section');
                submit_button();
                ?>
            </form>
        </div>
    </div>
    <?php
}

// CSS settings page
function yiontech_lms_css_settings_page() {
    ?>
    <div class="wrap">
        <h1>CSS Editor</h1>
        <div class="settings-container">
            <form method="post" action="options.php">
                <?php
                settings_fields('yiontech_lms_theme_settings');
                
                // Output hidden fields for all settings not in this section
                yiontech_lms_output_hidden_fields(array('custom_css'));
                
                yiontech_lms_output_settings_section('yiontech_lms_css_editor_section');
                submit_button();
                ?>
            </form>
        </div>
    </div>
    <?php
}

// Helper function to output a specific settings section
function yiontech_lms_output_settings_section($section_id) {
    global $wp_settings_sections, $wp_settings_fields;
    
    if (!isset($wp_settings_sections['yiontech_lms_theme_settings'][$section_id])) {
        return;
    }
    
    $section = $wp_settings_sections['yiontech_lms_theme_settings'][$section_id];
    
    // Output section heading
    echo '<div class="settings-section">';
    echo '<h2>' . esc_html($section['title']) . '</h2>';
    
    // Output section description if callback exists
    if (!empty($section['callback']) && is_callable($section['callback'])) {
        call_user_func($section['callback']);
    }
    
    // Output section fields
    if (isset($wp_settings_fields['yiontech_lms_theme_settings'][$section_id])) {
        echo '<table class="form-table" role="presentation">';
        foreach ((array) $wp_settings_fields['yiontech_lms_theme_settings'][$section_id] as $field) {
            echo '<tr>';
            if (!empty($field['args']['label_for'])) {
                echo '<th scope="row"><label for="' . esc_attr($field['args']['label_for']) . '">' . $field['title'] . '</label></th>';
            } else {
                echo '<th scope="row">' . $field['title'] . '</th>';
            }
            echo '<td>';
            call_user_func($field['callback'], $field['args']);
            echo '</td>';
            echo '</tr>';
        }
        echo '</table>';
    }
    
    echo '</div>';
}

// Section callbacks
function yiontech_lms_general_section_callback() {
    echo '<p>General theme settings</p>';
}

function yiontech_lms_header_section_callback() {
    echo '<p>Configure your website header</p>';
}

function yiontech_lms_footer_section_callback() {
    echo '<p>Configure your website footer</p>';
}

function yiontech_lms_newsletter_section_callback() {
    echo '<p>Newsletter configuration settings</p>';
}

function yiontech_lms_privacy_section_callback() {
    echo '<p>Configure privacy settings for GDPR compliance</p>';
}

function yiontech_lms_css_editor_section_callback() {
    echo '<p>Add custom CSS to your theme</p>';
}

// Field callbacks
function yiontech_lms_checkbox_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $value = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    $checked = $value ? 'checked="checked"' : '';
    ?>
    <label>
        <input type="checkbox" name="<?php echo esc_attr($args['name']); ?>" value="1" <?php echo $checked; ?> />
        <?php echo esc_html($args['description']); ?>
    </label>
    <?php
}

function yiontech_lms_select_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $value = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    ?>
    <select name="<?php echo esc_attr($args['name']); ?>">
        <?php foreach ($args['options'] as $option_value => $label) : ?>
            <option value="<?php echo esc_attr($option_value); ?>" <?php selected($value, $option_value); ?>>
                <?php echo esc_html($label); ?>
            </option>
        <?php endforeach; ?>
    </select>
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

function yiontech_lms_color_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $value = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    ?>
    <input type="color" name="<?php echo esc_attr($args['name']); ?>" value="<?php echo esc_attr($value); ?>" class="yiontech-color-field" />
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

function yiontech_lms_text_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $value = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    ?>
    <input type="text" name="<?php echo esc_attr($args['name']); ?>" value="<?php echo esc_attr($value); ?>" class="regular-text" />
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

function yiontech_lms_media_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $value = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    $media_id = attachment_url_to_postid($value);
    ?>
    <div class="media-field" data-field-id="<?php echo esc_attr($args['id']); ?>">
        <input type="hidden" name="<?php echo esc_attr($args['name']); ?>" id="<?php echo esc_attr($args['id']); ?>" value="<?php echo esc_attr($value); ?>" />
        <div class="media-preview">
            <?php if ($value) : ?>
                <img src="<?php echo esc_url($value); ?>" alt="" style="max-width: 200px; max-height: 100px;" />
            <?php endif; ?>
        </div>
        <button type="button" class="button media-upload-button">Upload</button>
        <button type="button" class="button media-remove-button" style="<?php echo $value ? '' : 'display:none;'; ?>">Remove</button>
        <?php if (isset($args['description'])) : ?>
            <p class="description"><?php echo esc_html($args['description']); ?></p>
        <?php endif; ?>
    </div>
    <?php
}

function yiontech_lms_textarea_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $value = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    $rows = isset($args['rows']) ? $args['rows'] : 5;
    ?>
    <textarea name="<?php echo esc_attr($args['name']); ?>" rows="<?php echo esc_attr($rows); ?>" class="large-text"><?php echo esc_textarea($value); ?></textarea>
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

function yiontech_lms_spacing_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $value = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    $top = isset($value['top']) ? $value['top'] : 48;
    $bottom = isset($value['bottom']) ? $value['bottom'] : 48;
    ?>
    <div class="spacing-field">
        <div>
            <label for="<?php echo esc_attr($args['id']); ?>_top">Top (px):</label>
            <input type="number" name="<?php echo esc_attr($args['name']); ?>[top]" id="<?php echo esc_attr($args['id']); ?>_top" value="<?php echo esc_attr($top); ?>" min="0" />
        </div>
        <div>
            <label for="<?php echo esc_attr($args['id']); ?>_bottom">Bottom (px):</label>
            <input type="number" name="<?php echo esc_attr($args['name']); ?>[bottom]" id="<?php echo esc_attr($args['id']); ?>_bottom" value="<?php echo esc_attr($bottom); ?>" min="0" />
        </div>
    </div>
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

function yiontech_lms_header_buttons_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $buttons = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    ?>
    <div class="header-buttons-field" data-field-name="<?php echo esc_attr($args['name']); ?>">
        <div class="header-buttons">
            <?php
            if (!empty($buttons)) {
                foreach ($buttons as $index => $button) {
                    $show_desktop = isset($button['show_desktop']) ? $button['show_desktop'] : true;
                    $show_mobile = isset($button['show_mobile']) ? $button['show_mobile'] : true;
                    ?>
                    <div class="header-button-item" data-index="<?php echo esc_attr($index); ?>">
                        <div>
                            <label>Button Text:</label>
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[<?php echo $index; ?>][text]" value="<?php echo esc_attr($button['text']); ?>" class="regular-text" />
                        </div>
                        <div>
                            <label>Button URL:</label>
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[<?php echo $index; ?>][url]" value="<?php echo esc_attr($button['url']); ?>" class="regular-text" />
                        </div>
                        <div>
                            <label>Button Style:</label>
                            <select name="<?php echo esc_attr($args['name']); ?>[<?php echo $index; ?>][style]">
                                <option value="solid" <?php selected($button['style'], 'solid'); ?>>Solid</option>
                                <option value="outline" <?php selected($button['style'], 'outline'); ?>>Outline</option>
                            </select>
                        </div>
                        <div>
                            <label>
                                <input type="checkbox" name="<?php echo esc_attr($args['name']); ?>[<?php echo $index; ?>][show_desktop]" value="1" <?php checked($show_desktop, true); ?> />
                                Show on Desktop
                            </label>
                        </div>
                        <div>
                            <label>
                                <input type="checkbox" name="<?php echo esc_attr($args['name']); ?>[<?php echo $index; ?>][show_mobile]" value="1" <?php checked($show_mobile, true); ?> />
                                Show on Mobile
                            </label>
                        </div>
                        <button type="button" class="button remove-button">Remove Button</button>
                    </div>
                    <?php
                }
            }
            ?>
        </div>
        <button type="button" class="button add-button">Add Button</button>
        <input type="hidden" class="item-counter" value="<?php echo esc_attr(count($buttons)); ?>" />
    </div>
    
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

function yiontech_lms_menu_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $menu_items = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    ?>
    <div class="menu-field" data-field-name="<?php echo esc_attr($args['name']); ?>">
        <div class="menu-items">
            <?php
            if (!empty($menu_items)) {
                foreach ($menu_items as $index => $item) {
                    ?>
                    <div class="menu-item" data-index="<?php echo esc_attr($index); ?>">
                        <div>
                            <label>Menu Text:</label>
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[<?php echo $index; ?>][text]" value="<?php echo esc_attr($item['text']); ?>" class="regular-text" />
                        </div>
                        <div>
                            <label>Menu URL:</label>
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[<?php echo $index; ?>][url]" value="<?php echo esc_attr($item['url']); ?>" class="regular-text" />
                        </div>
                        <button type="button" class="button remove-menu-item">Remove</button>
                    </div>
                    <?php
                }
            }
            ?>
        </div>
        <button type="button" class="button add-menu-item">Add Menu Item</button>
        <input type="hidden" class="item-counter" value="<?php echo esc_attr(count($menu_items)); ?>" />
    </div>
    
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

function yiontech_lms_footer_content_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $footer_content = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    ?>
    <div class="footer-content-field" data-field-name="<?php echo esc_attr($args['name']); ?>">
        <h4>Column 1</h4>
        <div>
            <label>Title:</label>
            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column1][title]" value="<?php echo esc_attr($footer_content['column1']['title']); ?>" class="regular-text" />
        </div>
        <div>
            <label>Content:</label>
            <textarea name="<?php echo esc_attr($args['name']); ?>[column1][content]" rows="4" class="large-text"><?php echo esc_textarea($footer_content['column1']['content']); ?></textarea>
        </div>
        
        <h4>Column 2</h4>
        <div>
            <label>Title:</label>
            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column2][title]" value="<?php echo esc_attr($footer_content['column2']['title']); ?>" class="regular-text" />
        </div>
        <div>
            <label>Links:</label>
            <div class="footer-links" data-column="column2">
                <?php
                if (!empty($footer_content['column2']['links'])) {
                    foreach ($footer_content['column2']['links'] as $index => $link) {
                        ?>
                        <div class="footer-link-item" data-index="<?php echo esc_attr($index); ?>">
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column2][links][<?php echo $index; ?>][text]" value="<?php echo esc_attr($link['text']); ?>" placeholder="Link Text" class="regular-text" />
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column2][links][<?php echo $index; ?>][url]" value="<?php echo esc_attr($link['url']); ?>" placeholder="Link URL" class="regular-text" />
                            <button type="button" class="button remove-link">Remove</button>
                        </div>
                        <?php
                    }
                }
                ?>
            </div>
            <button type="button" class="button add-link" data-column="column2">Add Link</button>
            <input type="hidden" class="item-counter" data-column="column2" value="<?php echo esc_attr(count($footer_content['column2']['links'])); ?>" />
        </div>
        
        <h4>Column 3</h4>
        <div>
            <label>Title:</label>
            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column3][title]" value="<?php echo esc_attr($footer_content['column3']['title']); ?>" class="regular-text" />
        </div>
        <div>
            <label>Links:</label>
            <div class="footer-links" data-column="column3">
                <?php
                if (!empty($footer_content['column3']['links'])) {
                    foreach ($footer_content['column3']['links'] as $index => $link) {
                        ?>
                        <div class="footer-link-item" data-index="<?php echo esc_attr($index); ?>">
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column3][links][<?php echo $index; ?>][text]" value="<?php echo esc_attr($link['text']); ?>" placeholder="Link Text" class="regular-text" />
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column3][links][<?php echo $index; ?>][url]" value="<?php echo esc_attr($link['url']); ?>" placeholder="Link URL" class="regular-text" />
                            <button type="button" class="button remove-link">Remove</button>
                        </div>
                        <?php
                    }
                }
                ?>
            </div>
            <button type="button" class="button add-link" data-column="column3">Add Link</button>
            <input type="hidden" class="item-counter" data-column="column3" value="<?php echo esc_attr(count($footer_content['column3']['links'])); ?>" />
        </div>
        
        <h4>Column 4</h4>
        <div>
            <label>Title:</label>
            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column4][title]" value="<?php echo esc_attr($footer_content['column4']['title']); ?>" class="regular-text" />
        </div>
        <div>
            <label>Links:</label>
            <div class="footer-links" data-column="column4">
                <?php
                if (!empty($footer_content['column4']['links'])) {
                    foreach ($footer_content['column4']['links'] as $index => $link) {
                        ?>
                        <div class="footer-link-item" data-index="<?php echo esc_attr($index); ?>">
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column4][links][<?php echo $index; ?>][text]" value="<?php echo esc_attr($link['text']); ?>" placeholder="Link Text" class="regular-text" />
                            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column4][links][<?php echo $index; ?>][url]" value="<?php echo esc_attr($link['url']); ?>" placeholder="Link URL" class="regular-text" />
                            <button type="button" class="button remove-link">Remove</button>
                        </div>
                        <?php
                    }
                }
                ?>
            </div>
            <button type="button" class="button add-link" data-column="column4">Add Link</button>
            <input type="hidden" class="item-counter" data-column="column4" value="<?php echo esc_attr(count($footer_content['column4']['links'])); ?>" />
        </div>
        
        <h4>Column 5</h4>
        <div>
            <label>Title:</label>
            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column5][title]" value="<?php echo esc_attr($footer_content['column5']['title']); ?>" class="regular-text" />
        </div>
        <div>
            <label>Content:</label>
            <textarea name="<?php echo esc_attr($args['name']); ?>[column5][content]" rows="4" class="large-text"><?php echo esc_textarea($footer_content['column5']['content']); ?></textarea>
        </div>
        <div>
            <label>Email:</label>
            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column5][email]" value="<?php echo esc_attr($footer_content['column5']['email']); ?>" class="regular-text" />
        </div>
        <div>
            <label>Phone:</label>
            <input type="text" name="<?php echo esc_attr($args['name']); ?>[column5][phone]" value="<?php echo esc_attr($footer_content['column5']['phone']); ?>" class="regular-text" />
        </div>
    </div>
    
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

// Page select field callback
function yiontech_lms_page_select_field($args) {
    $options = get_option('yiontech_lms_theme_settings');
    $defaults = yiontech_lms_get_default_settings();
    $value = isset($options[$args['id']]) ? $options[$args['id']] : $defaults[$args['id']];
    
    // Get all pages
    $pages = get_pages();
    
    ?>
    <select name="<?php echo esc_attr($args['name']); ?>">
        <option value="0"><?php _e('— Select —', 'yiontech-lms'); ?></option>
        <?php foreach ($pages as $page) : ?>
            <option value="<?php echo esc_attr($page->ID); ?>" <?php selected($value, $page->ID); ?>>
                <?php echo esc_html($page->post_title); ?>
            </option>
        <?php endforeach; ?>
    </select>
    <?php if (isset($args['description'])) : ?>
        <p class="description"><?php echo esc_html($args['description']); ?></p>
    <?php endif; ?>
    <?php
}

===== ./single.php =====

<?php get_header(); ?>
<?php 
while (have_posts()) : the_post(); 
    // Check if Elementor is being used for this post
    if (function_exists('\\Elementor\\Plugin') && \Elementor\Plugin::$instance->documents->get(get_the_ID())->is_built_with_elementor()) {
        // Full width for Elementor pages
        the_content();
    } else {
        // Regular theme layout with container
        ?>
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row">
                <div class="w-full md:w-2/3 md:pr-8">
                    <article id="post-<?php the_ID(); ?>" <?php post_class('bg-white rounded-lg shadow-md overflow-hidden mb-8'); ?>>
                        <header class="p-0 border-b">
                            <h1 class="text-3xl font-bold mb-2"><?php the_title(); ?></h1>
                            <div class="text-gray-600">
                                <?php echo get_the_date(); ?> by <?php the_author(); ?>
                            </div>
                        </header>
                        
                        <?php if (has_post_thumbnail()) : ?>
                            <div class="post-thumbnail">
                                <?php the_post_thumbnail('large', array('class' => 'w-full h-64 object-cover')); ?>
                            </div>
                        <?php endif; ?>
                        
                        <div class="content p-0">
                            <?php the_content(); ?>
                        </div>
                        
                        <?php
                        wp_link_pages(array(
                            'before' => '<div class="page-links mb-4">' . __('Pages:', 'yiontech-lms'),
                            'after'  => '</div>',
                        ));
                        ?>
                        
                        <footer class="p-6 bg-gray-50 border-t">
                            <div class="flex flex-wrap gap-2">
                                <?php the_tags('<span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">', '</span>'); ?>
                            </div>
                        </footer>
                    </article>
                    
                    <?php comments_template(); ?>
                </div>
                <div class="w-full md:w-1/3 mt-8 md:mt-0">
                    <?php get_sidebar(); ?>
                </div>
            </div>
        </div>
        <?php
    }
endwhile; 
?>
<?php get_footer(); ?>

===== ./comments.php =====

<?php if (comments_open() || get_comments_number()) : ?>
    <div id="comments" class="comments-area my-8 bg-white rounded-lg shadow-md p-6">
        <?php if (have_comments()) : ?>
            <h3 class="comments-title text-xl font-bold mb-4">
                <?php
                printf(
                    _nx(
                        'One comment',
                        '%1$s comments',
                        get_comments_number(),
                        'comments title',
                        'yiontech-lms'
                    ),
                    number_format_i18n(get_comments_number())
                );
                ?>
            </h3>
            
            <ul class="comment-list space-y-4">
                <?php wp_list_comments(array('style' => 'ul', 'callback' => 'yiontech_lms_comment')); ?>
            </ul>
        <?php endif; ?>
        
        <?php 
        // Get privacy settings
        $enable_privacy_features = yiontech_lms_get_theme_setting('enable_privacy_features');
        $privacy_policy_url = yiontech_lms_get_privacy_policy_url();
        $terms_of_service_url = yiontech_lms_get_terms_of_service_url();
        ?>
        
        comment_form(array(
            'fields' => array(
                'author' => '<div class="comment-form-author mb-4">' . '<label for="author">' . __('Name', 'yiontech-lms') . '</label> ' . ($req ? '<span class="required">*</span>' : '') . '<input id="author" name="author" type="text" value="' . esc_attr($commenter['comment_author']) . '" size="30" maxlength="245" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" /></div>',
                'email'  => '<div class="comment-form-email mb-4">' . '<label for="email">' . __('Email', 'yiontech-lms') . '</label> ' . ($req ? '<span class="required">*</span>' : '') . '<input id="email" name="email" type="email" value="' . esc_attr($commenter['comment_author_email']) . '" size="30" maxlength="100" aria-describedby="email-notes" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" /></div>',
                'url'    => '<div class="comment-form-url mb-4">' . '<label for="url">' . __('Website', 'yiontech-lms') . '</label>' . '<input id="url" name="url" type="url" value="' . esc_attr($commenter['comment_author_url']) . '" size="30" maxlength="200" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" /></div>',
                'cookies' => '<div class="comment-form-cookies-consent mb-4"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes"' . $consent . ' /> <label for="wp-comment-cookies-consent">' . __('Save my name, email, and website in this browser for the next time I comment.', 'yiontech-lms') . '</label></div>',
            ),
            'comment_field' => '<div class="comment-form-comment mb-4"><label for="comment">' . _x('Comment', 'noun', 'yiontech-lms') . '</label><textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea></div>',
            'submit_button' => '<button name="%1$s" type="submit" id="%2$s" class="%3$s px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-300">%4$s</button>',
            'submit_field' => '<p class="form-submit mt-4">%1$s %2$s</p>',
            'must_log_in' => '<p class="must-log-in">' . sprintf(__('You must be <a href="%s">logged in</a> to post a comment.', 'yiontech-lms'), wp_login_url(apply_filters('the_permalink', get_permalink($post_id)))) . '</p>',
            'logged_in_as' => '<p class="logged-in-as">' . sprintf(__('Logged in as <a href="%1$s">%2$s</a>. <a href="%3$s" title="Log out of this account">Log out?</a>', 'yiontech-lms'), get_edit_user_link(), $user_identity, wp_logout_url(apply_filters('the_permalink', get_permalink($post_id)))) . '</p>',
            'comment_notes_before' => '<p class="comment-notes"><span id="email-notes">' . __('Your email address will not be published.', 'yiontech-lms') . '</span>' . ($req ? $required_text : '') . '</p>',
            'comment_notes_after' => '',
            'id_form' => 'commentform',
            'id_submit' => 'submit',
            'class_submit' => 'submit',
            'name_submit' => 'submit',
            'title_reply' => __('Leave a Reply', 'yiontech-lms'),
            'title_reply_to' => __('Leave a Reply to %s', 'yiontech-lms'),
            'title_reply_before' => '<h3 id="reply-title" class="comment-reply-title text-xl font-bold mb-4">',
            'title_reply_after' => '</h3>',
            'cancel_reply_before' => ' <small>',
            'cancel_reply_after' => '</small>',
            'cancel_reply_link' => __('Cancel reply', 'yiontech-lms'),
            'label_submit' => __('Post Comment', 'yiontech-lms'),
            'submit_button' => '<button name="%1$s" type="submit" id="%2$s" class="%3$s px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-300">%4$s</button>',
            'submit_field' => '<p class="form-submit mt-4">%1$s %2$s</p>',
            'format' => 'html5',
        ));
        ?>
    </div>
<?php endif; ?>

===== ./page-register.php =====

<?php
/**
 * Template Name: Custom Registration Page
 *
 * @package Yiontech_LMS
 */

// Add custom body class
add_filter('body_class', function($classes) {
    $classes[] = 'register-page';
    return $classes;
});

// Output minimal HTML structure for register page
get_header();
?>

<div class="site-content">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="flex justify-center">
            <div class="w-full md:w-2/3">
                <?php echo do_shortcode('[custom_registration_form]'); ?>
            </div>
        </div>
    </div>
</div>

<?php get_footer(); ?>

===== ./header.php =====

<?php
/**
 * Header template for Yiontech LMS
 */

// Check if this is a login or register page
$is_auth_page = is_page_template('page-login.php') || is_page_template('page-register.php');

// Don't load header for auth pages
if ($is_auth_page) {
    // Only output essential HTML for auth pages
    ?>
    <!DOCTYPE html>
    <html <?php language_attributes(); ?>>
    <head>
        <meta charset="<?php bloginfo('charset'); ?>">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <?php wp_head(); ?>
    </head>
    <body <?php body_class(); ?>>
    <?php
    return;
}
?>
<!DOCTYPE html>
<html <?php language_attributes(); ?>>
<head>
    <meta charset="<?php bloginfo('charset'); ?>">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <?php 
    // Site Icon
    $site_icon = yiontech_lms_get_theme_setting('site_icon');
    if ($site_icon) {
        echo '<link rel="icon" href="' . esc_url($site_icon) . '" type="image/x-icon">';
    }
    ?>
    <?php wp_head(); ?>
</head>
<body <?php body_class(); ?>>
<?php
// Preloader
$enable_preloader = yiontech_lms_get_theme_setting('enable_preloader');
if ($enable_preloader) {
    ?>
    <div id="preloader">
        <div class="preloader-spinner">
            <div class="spinner"></div>
        </div>
    </div>
    <?php
}
?>

<?php
$header_style = yiontech_lms_get_theme_setting('header_style', 'default');
$transparent_header = yiontech_lms_get_theme_setting('transparent_header');
$sticky_header = yiontech_lms_get_theme_setting('sticky_header', true);
$header_background_color = yiontech_lms_get_theme_setting('header_background_color', '#1e40af');
$sticky_header_background_color = yiontech_lms_get_theme_setting('sticky_header_background_color', '#1e40af');
$logo = yiontech_lms_get_theme_setting('logo_upload');
$retina_logo = yiontech_lms_get_theme_setting('retina_logo_upload');
$header_buttons = yiontech_lms_get_theme_setting('header_buttons');
$header_menu = yiontech_lms_get_theme_setting('header_menu');

// Get privacy settings
$enable_privacy_features = yiontech_lms_get_theme_setting('enable_privacy_features');
$privacy_policy_url = yiontech_lms_get_privacy_policy_url();
$terms_of_service_url = yiontech_lms_get_terms_of_service_url();
?>
<?php if ($header_style == 'default') : ?>
<header class="site-header text-white <?php echo $sticky_header ? 'header-sticky-enabled' : ''; ?> <?php echo $transparent_header && is_front_page() ? 'header-transparent' : ''; ?>" 
      <?php if (!$transparent_header || !is_front_page()) : ?>style="background-color: <?php echo esc_attr($header_background_color); ?>;"<?php endif; ?>>
    <?php 
    if ( function_exists( 'elementor_theme_do_location' ) && elementor_theme_do_location( 'header' ) ) {
        // Elementor header
    } else {
        // Default theme header
        ?>
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-3">
                <!-- Logo (Left) -->
                <div class="site-branding flex items-center">
                    <?php if ($logo) : ?>
                        <a href="<?php echo esc_url( home_url( '/' ) ); ?>" class="custom-logo-link">
                            <img src="<?php echo esc_url($logo); ?>" class="custom-logo" alt="<?php bloginfo('name'); ?>" <?php echo $retina_logo ? 'srcset="' . esc_url($logo) . ' 1x, ' . esc_url($retina_logo) . ' 2x"' : ''; ?>>
                        </a>
                    <?php elseif ( has_custom_logo() ) : ?>
                        <?php the_custom_logo(); ?>
                    <?php else : ?>
                        <h1 class="text-xl font-bold"><a href="<?php echo esc_url( home_url( '/' ) ); ?>" class="text-white"><?php bloginfo( 'name' ); ?></a></h1>
                    <?php endif; ?>
                </div>
                
                <!-- Desktop Navigation (Center) -->
                <nav id="site-navigation" class="main-navigation hidden xl:flex flex-1 justify-center">
                    <?php if (!empty($header_menu)) : ?>
                        <ul class="flex space-x-8 items-center">
                            <?php foreach ($header_menu as $item) : ?>
                                <li>
                                    <a href="<?php echo esc_url($item['url']); ?>" class="text-white hover:text-gray-200 transition">
                                        <?php echo esc_html($item['text']); ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                            
                            <!-- Add privacy links if enabled -->
                            <?php if ($enable_privacy_features && $privacy_policy_url) : ?>
                                <li>
                                    <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-white hover:text-gray-200 transition">
                                        Privacy Policy
                                    </a>
                                </li>
                            <?php endif; ?>
                            
                            <?php if ($enable_privacy_features && $terms_of_service_url) : ?>
                                <li>
                                    <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-white hover:text-gray-200 transition">
                                        Terms of Service
                                    </a>
                                </li>
                            <?php endif; ?>
                        </ul>
                    <?php else : ?>
                        <?php
                        wp_nav_menu( array(
                            'theme_location' => 'primary',
                            'menu_class'     => 'flex space-x-8 items-center',
                            'container'      => false,
                        ) );
                        ?>
                    <?php endif; ?>
                </nav>
                
                <!-- Right Side Buttons -->
                <div class="flex items-center space-x-3">
                    <?php if (!empty($header_buttons)) : ?>
                        <?php foreach ($header_buttons as $button) : ?>
                            <?php 
                            $show_desktop = isset($button['show_desktop']) ? $button['show_desktop'] : true;
                            $show_mobile = isset($button['show_mobile']) ? $button['show_mobile'] : true;
                            if ($show_desktop) : 
                            ?>
                                <a href="<?php echo esc_url($button['url']); ?>" 
                                   class="hidden xl:block px-4 py-1.5 text-sm rounded-lg transition duration-300 
                                          <?php echo $button['style'] == 'solid' ? 'bg-white text-blue-600 hover:bg-blue-50' : 'border border-white hover:bg-white hover:text-blue-600'; ?>">
                                    <?php echo esc_html($button['text']); ?>
                                </a>
                            <?php endif; ?>
                            
                            <?php if ($show_mobile) : 
                                // Show only the first button on mobile
                                if ($button === reset($header_buttons)) :
                            ?>
                                <a href="<?php echo esc_url($button['url']); ?>" 
                                   class="xl:hidden px-4 py-1.5 text-sm rounded-lg transition duration-300 
                                          <?php echo $button['style'] == 'solid' ? 'bg-white text-blue-600 hover:bg-blue-50' : 'border border-white hover:bg-white hover:text-blue-600'; ?>">
                                    <?php echo esc_html($button['text']); ?>
                                </a>
                            <?php 
                                endif;
                            endif; ?>
                        <?php endforeach; ?>
                    <?php endif; ?>
                    
                    <!-- Mobile Menu Toggle -->
                    <button id="mobile-menu-toggle" class="text-white focus:outline-none p-1">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <?php
    }
    ?>
</header>
<?php elseif ($header_style == 'minimal') : ?>
<header class="site-header text-white <?php echo $sticky_header ? 'sticky top-0 z-50' : ''; ?> <?php echo $transparent_header && is_front_page() ? 'header-transparent' : ''; ?>" 
      <?php if (!$transparent_header || !is_front_page()) : ?>style="background-color: <?php echo esc_attr($header_background_color); ?>;"<?php endif; ?>>
    <?php 
    if ( function_exists( 'elementor_theme_do_location' ) && elementor_theme_do_location( 'header' ) ) {
        // Elementor header
    } else {
        // Minimal theme header
        ?>
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-2">
                <!-- Logo (Left) -->
                <div class="site-branding flex items-center">
                    <?php if ($logo) : ?>
                        <a href="<?php echo esc_url( home_url( '/' ) ); ?>" class="custom-logo-link">
                            <img src="<?php echo esc_url($logo); ?>" class="custom-logo" alt="<?php bloginfo('name'); ?>" <?php echo $retina_logo ? 'srcset="' . esc_url($logo) . ' 1x, ' . esc_url($retina_logo) . ' 2x"' : ''; ?>>
                        </a>
                    <?php elseif ( has_custom_logo() ) : ?>
                        <?php the_custom_logo(); ?>
                    <?php else : ?>
                        <h1 class="text-xl font-bold"><a href="<?php echo esc_url( home_url( '/' ) ); ?>" class="text-white"><?php bloginfo( 'name' ); ?></a></h1>
                    <?php endif; ?>
                </div>
                
                <!-- Desktop Navigation (Center) -->
                <nav id="site-navigation" class="main-navigation hidden xl:flex flex-1 justify-center">
                    <?php if (!empty($header_menu)) : ?>
                        <ul class="flex space-x-6 items-center text-sm">
                            <?php foreach ($header_menu as $item) : ?>
                                <li>
                                    <a href="<?php echo esc_url($item['url']); ?>" class="text-white hover:text-gray-200 transition">
                                        <?php echo esc_html($item['text']); ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                            
                            <!-- Add privacy links if enabled -->
                            <?php if ($enable_privacy_features && $privacy_policy_url) : ?>
                                <li>
                                    <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-white hover:text-gray-200 transition">
                                        Privacy Policy
                                    </a>
                                </li>
                            <?php endif; ?>
                            
                            <?php if ($enable_privacy_features && $terms_of_service_url) : ?>
                                <li>
                                    <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-white hover:text-gray-200 transition">
                                        Terms of Service
                                    </a>
                                </li>
                            <?php endif; ?>
                        </ul>
                    <?php else : ?>
                        <?php
                        wp_nav_menu( array(
                            'theme_location' => 'primary',
                            'menu_class'     => 'flex space-x-6 items-center text-sm',
                            'container'      => false,
                        ) );
                        ?>
                    <?php endif; ?>
                </nav>
                
                <!-- Right Side Buttons -->
                <div class="flex items-center space-x-3">
                    <?php if (!empty($header_buttons)) : ?>
                        <?php foreach ($header_buttons as $button) : ?>
                            <?php 
                            $show_desktop = isset($button['show_desktop']) ? $button['show_desktop'] : true;
                            $show_mobile = isset($button['show_mobile']) ? $button['show_mobile'] : true;
                            if ($show_desktop) : 
                            ?>
                                <a href="<?php echo esc_url($button['url']); ?>" 
                                   class="hidden xl:block px-3 py-1 text-sm rounded transition duration-300 
                                          <?php echo $button['style'] == 'solid' ? 'bg-white text-blue-600 hover:bg-blue-50' : 'border border-white hover:bg-white hover:text-blue-600'; ?>">
                                    <?php echo esc_html($button['text']); ?>
                                </a>
                            <?php endif; ?>
                            
                            <?php if ($show_mobile) : 
                                // Show only the first button on mobile
                                if ($button === reset($header_buttons)) :
                            ?>
                                <a href="<?php echo esc_url($button['url']); ?>" 
                                   class="xl:hidden px-3 py-1 text-sm rounded transition duration-300 
                                          <?php echo $button['style'] == 'solid' ? 'bg-white text-blue-600 hover:bg-blue-50' : 'border border-white hover:bg-white hover:text-blue-600'; ?>">
                                    <?php echo esc_html($button['text']); ?>
                                </a>
                            <?php 
                                endif;
                            endif; ?>
                        <?php endforeach; ?>
                    <?php endif; ?>
                    
                    <!-- Mobile Menu Toggle -->
                    <button id="mobile-menu-toggle" class="text-white focus:outline-none p-1">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <?php
    }
    ?>
</header>
<?php elseif ($header_style == 'centered') : ?>
<header class="site-header text-white <?php echo $sticky_header ? 'sticky top-0 z-50' : ''; ?> <?php echo $transparent_header && is_front_page() ? 'header-transparent' : ''; ?>" 
      <?php if (!$transparent_header || !is_front_page()) : ?>style="background-color: <?php echo esc_attr($header_background_color); ?>;"<?php endif; ?>>
    <?php 
    if ( function_exists( 'elementor_theme_do_location' ) && elementor_theme_do_location( 'header' ) ) {
        // Elementor header
    } else {
        // Centered theme header
        ?>
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col items-center py-4">
                <!-- Logo (Center) -->
                <div class="site-branding flex items-center mb-3">
                    <?php if ($logo) : ?>
                        <a href="<?php echo esc_url( home_url( '/' ) ); ?>" class="custom-logo-link">
                            <img src="<?php echo esc_url($logo); ?>" class="custom-logo" alt="<?php bloginfo('name'); ?>" <?php echo $retina_logo ? 'srcset="' . esc_url($logo) . ' 1x, ' . esc_url($retina_logo) . ' 2x"' : ''; ?>>
                        </a>
                    <?php elseif ( has_custom_logo() ) : ?>
                        <?php the_custom_logo(); ?>
                    <?php else : ?>
                        <h1 class="text-xl font-bold"><a href="<?php echo esc_url( home_url( '/' ) ); ?>" class="text-white"><?php bloginfo( 'name' ); ?></a></h1>
                    <?php endif; ?>
                </div>
                
                <!-- Desktop Navigation (Center) -->
                <nav id="site-navigation" class="main-navigation hidden xl:flex justify-center w-full">
                    <?php if (!empty($header_menu)) : ?>
                        <ul class="flex space-x-8 items-center">
                            <?php foreach ($header_menu as $item) : ?>
                                <li>
                                    <a href="<?php echo esc_url($item['url']); ?>" class="text-white hover:text-gray-200 transition">
                                        <?php echo esc_html($item['text']); ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                            
                            <!-- Add privacy links if enabled -->
                            <?php if ($enable_privacy_features && $privacy_policy_url) : ?>
                                <li>
                                    <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-white hover:text-gray-200 transition">
                                        Privacy Policy
                                    </a>
                                </li>
                            <?php endif; ?>
                            
                            <?php if ($enable_privacy_features && $terms_of_service_url) : ?>
                                <li>
                                    <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-white hover:text-gray-200 transition">
                                        Terms of Service
                                    </a>
                                </li>
                            <?php endif; ?>
                        </ul>
                    <?php else : ?>
                        <?php
                        wp_nav_menu( array(
                            'theme_location' => 'primary',
                            'menu_class'     => 'flex space-x-8 items-center',
                            'container'      => false,
                        ) );
                        ?>
                    <?php endif; ?>
                </nav>
                
                <!-- Right Side Buttons -->
                <div class="flex items-center space-x-3 mt-3">
                    <?php if (!empty($header_buttons)) : ?>
                        <?php foreach ($header_buttons as $button) : ?>
                            <?php 
                            $show_desktop = isset($button['show_desktop']) ? $button['show_desktop'] : true;
                            $show_mobile = isset($button['show_mobile']) ? $button['show_mobile'] : true;
                            if ($show_desktop) : 
                            ?>
                                <a href="<?php echo esc_url($button['url']); ?>" 
                                   class="hidden xl:block px-4 py-1.5 text-sm rounded-lg transition duration-300 
                                          <?php echo $button['style'] == 'solid' ? 'bg-white text-blue-600 hover:bg-blue-50' : 'border border-white hover:bg-white hover:text-blue-600'; ?>">
                                    <?php echo esc_html($button['text']); ?>
                                </a>
                            <?php endif; ?>
                            
                            <?php if ($show_mobile) : 
                                // Show only the first button on mobile
                                if ($button === reset($header_buttons)) :
                            ?>
                                <a href="<?php echo esc_url($button['url']); ?>" 
                                   class="xl:hidden px-4 py-1.5 text-sm rounded-lg transition duration-300 
                                          <?php echo $button['style'] == 'solid' ? 'bg-white text-blue-600 hover:bg-blue-50' : 'border border-white hover:bg-white hover:text-blue-600'; ?>">
                                    <?php echo esc_html($button['text']); ?>
                                </a>
                            <?php 
                                endif;
                            endif; ?>
                        <?php endforeach; ?>
                    <?php endif; ?>
                    
                    <!-- Mobile Menu Toggle -->
                    <button id="mobile-menu-toggle" class="text-white focus:outline-none p-1">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <?php
    }
    ?>
</header>
<?php endif; ?>

<!-- Mobile Menu Overlay -->
<div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"></div>

<!-- Mobile Menu Sidebar -->
<div id="mobile-menu-sidebar" class="fixed top-0 right-0 h-full w-80 bg-white z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
    <div class="flex flex-col h-full">
        <!-- Menu Header -->
        <div class="flex items-center justify-between p-4" style="background-color: <?php echo esc_attr($header_background_color); ?>; color: white;">
            <div class="site-branding flex items-center">
                <?php if ($logo) : ?>
                    <img src="<?php echo esc_url($logo); ?>" class="custom-logo" alt="<?php bloginfo('name'); ?>" style="max-height: 36px; width: auto;">
                <?php elseif ( has_custom_logo() ) : ?>
                    <?php the_custom_logo(); ?>
                <?php else : ?>
                    <h2 class="text-xl font-bold"><?php bloginfo( 'name' ); ?></h2>
                <?php endif; ?>
            </div>
            <button id="mobile-menu-close" class="text-white focus:outline-none p-1">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <!-- Menu Content -->
        <div class="flex-grow overflow-y-auto">
            <!-- Main Navigation -->
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Navigation</h3>
                <?php if (!empty($header_menu)) : ?>
                    <ul class="space-y-2">
                        <?php foreach ($header_menu as $item) : ?>
                            <li>
                                <a href="<?php echo esc_url($item['url']); ?>" class="text-gray-600 hover:text-blue-600 transition">
                                    <?php echo esc_html($item['text']); ?>
                                </a>
                            </li>
                        <?php endforeach; ?>
                        
                        <!-- Add privacy links if enabled -->
                        <?php if ($enable_privacy_features && $privacy_policy_url) : ?>
                            <li>
                                <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-gray-600 hover:text-blue-600 transition">
                                    Privacy Policy
                                </a>
                            </li>
                        <?php endif; ?>
                        
                        <?php if ($enable_privacy_features && $terms_of_service_url) : ?>
                            <li>
                                <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-gray-600 hover:text-blue-600 transition">
                                    Terms of Service
                                </a>
                            </li>
                        <?php endif; ?>
                    </ul>
                <?php else : ?>
                    <?php
                    wp_nav_menu( array(
                        'theme_location' => 'primary',
                        'menu_class'     => 'space-y-2',
                        'container'      => false,
                    ) );
                    ?>
                <?php endif; ?>
            </div>
            
            <!-- Mobile Buttons -->
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Quick Actions</h3>
                <div class="space-y-3">
                    <?php if (!empty($header_buttons)) : ?>
                        <?php foreach ($header_buttons as $button) : ?>
                            <?php 
                            $show_mobile = isset($button['show_mobile']) ? $button['show_mobile'] : true;
                            if ($show_mobile) : 
                            ?>
                                <a href="<?php echo esc_url($button['url']); ?>" 
                                   class="block px-4 py-2 text-center rounded-lg transition duration-300 
                                          <?php echo $button['style'] == 'solid' ? 'bg-blue-600 text-white hover:bg-blue-700' : 'border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white'; ?>">
                                    <?php echo esc_html($button['text']); ?>
                                </a>
                            <?php endif; ?>
                        <?php endforeach; ?>
                    <?php endif; ?>
                </div>
            </div>
            
            <!-- User Portal -->
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">User Portal</h3>
                <div class="space-y-3">
                    <a href="<?php echo esc_url( home_url( '/login' ) ); ?>" class="block px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition duration-300">Login</a>
                    <a href="<?php echo esc_url( home_url( '/register' ) ); ?>" class="block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300">Create Account</a>
                    <a href="<?php echo esc_url( home_url( '/dashboard' ) ); ?>" class="block px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition duration-300">My Dashboard</a>
                </div>
            </div>
            
            <!-- Quick Links -->
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Quick Links</h3>
                <?php
                wp_nav_menu( array(
                    'theme_location' => 'footer-quick-links',
                    'menu_class'     => 'space-y-2',
                    'container'      => false,
                ) );
                ?>
            </div>
            
            <!-- Contact Information -->
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Contact Us</h3>
                <ul class="space-y-2 text-gray-600">
                    <li class="flex items-start">
                        <svg class="w-5 h-5 mr-2 mt-0.5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <span>info@yiontech.com</span>
                    </li>
                    <li class="flex items-start">
                        <svg class="w-5 h-5 mr-2 mt-0.5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                        </svg>
                        <span>+1 (555) 123-4567</span>
                    </li>
                </ul>
            </div>
            
            <!-- Social Media -->
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Follow Us</h3>
                <div class="flex space-x-4">
                    <a href="#" class="text-blue-600 hover:text-blue-800">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"/>
                        </svg>
                    </a>
                    <a href="#" class="text-blue-400 hover:text-blue-600">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"/>
                        </svg>
                    </a>
                    <a href="#" class="text-pink-600 hover:text-pink-800">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
                        </svg>
                    </a>
                </div>
            </div>
            
            <!-- Newsletter Signup -->
            <div class="p-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Newsletter</h3>
                <p class="text-gray-600 text-sm mb-3">Subscribe to get the latest updates and offers.</p>
                <?php get_template_part('template-parts/newsletter-form'); ?>
            </div>
        </div>
        
        <!-- Menu Footer -->
        <div class="p-4 bg-gray-100 border-t">
            <div class="text-center text-gray-600 text-sm">
                <p>&copy; <?php echo date('Y'); ?> <?php bloginfo('name'); ?></p>
                <p class="mt-1">All rights reserved.</p>
            </div>
        </div>
    </div>
</div>

<?php
// Add custom CSS from theme settings
$custom_css = yiontech_lms_get_theme_setting('custom_css');
if ($custom_css) {
    ?>
    <style>
        <?php echo $custom_css; ?>
        
        /* Transparent header styles */
        .header-transparent {
            box-shadow: none;
        }
        
        /* Prevent layout shifts when mobile menu opens */
        body.mobile-menu-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        
        /* Mobile menu sidebar */
        #mobile-menu-sidebar {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Prevent horizontal overflow on homepage */
        body, html {
            overflow-x: hidden;
            width: 100%;
        }
        
        .site-content {
            overflow: hidden;
            width: 100%;
        }
        
        img, video, iframe {
            max-width: 100%;
            height: auto;
        }
        
        /* Fix for Elementor sections */
        .elementor-section {
            overflow: hidden;
        }
        
        /* Sticky header styles */
        .site-header.sticky {
            position: sticky;
            top: 0;
            z-index: 999;
            width: 100%;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .site-header.scrolled {
            background-color: #1e40af !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
        }
        
        /* Cookie consent banner */
        .cookie-consent-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1e293b;
            color: white;
            padding: 15px;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .cookie-consent-content {
            flex: 1;
            margin-right: 15px;
        }
        
        .cookie-consent-buttons {
            display: flex;
            gap: 10px;
        }
        
        .cookie-consent-buttons .button {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        
        .cookie-consent-accept {
            background: #3b82f6;
            color: white;
        }
        
        .cookie-consent-accept:hover {
            background: #2563eb;
        }
        
        .cookie-consent-learn {
            background: transparent;
            color: white;
            border: 1px solid white;
        }
        
        .cookie-consent-learn:hover {
            background: rgba(255,255,255,0.1);
        }
    </style>
    <?php
}
?>

===== ./template-parts/newsletter-form.php =====

<?php
/**
 * Newsletter form template
 *
 * @package Yiontech_LMS
 */
?>
<?php
$newsletter_enable = yiontech_lms_get_theme_setting('newsletter_enable');
$newsletter_action_url = yiontech_lms_get_theme_setting('newsletter_action_url');
$newsletter_method = yiontech_lms_get_theme_setting('newsletter_method', 'post');
$newsletter_email_field = yiontech_lms_get_theme_setting('newsletter_email_field', 'email');
$newsletter_hidden_fields = yiontech_lms_get_theme_setting('newsletter_hidden_fields', '');

// Get privacy settings
$enable_privacy_features = yiontech_lms_get_theme_setting('enable_privacy_features');
$privacy_policy_url = yiontech_lms_get_privacy_policy_url();
$terms_of_service_url = yiontech_lms_get_terms_of_service_url();
?>
<?php if ($newsletter_enable && $newsletter_action_url) : ?>
<div class="newsletter-form">
    <form id="newsletter-form" class="mt-4" action="<?php echo esc_url($newsletter_action_url); ?>" method="<?php echo esc_attr($newsletter_method); ?>">
        <?php
        // Add hidden fields
        if (!empty($newsletter_hidden_fields)) {
            $lines = explode("\n", $newsletter_hidden_fields);
            foreach ($lines as $line) {
                $parts = explode('=', $line, 2);
                if (count($parts) == 2) {
                    echo '<input type="hidden" name="' . esc_attr(trim($parts[0])) . '" value="' . esc_attr(trim($parts[1])) . '" />';
                }
            }
        }
        ?>
        <div class="flex flex-col sm:flex-col gap-2">
            <input type="email" name="<?php echo esc_attr($newsletter_email_field); ?>" placeholder="Your email address" 
                   class="px-4 py-2 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 flex-grow" required>
            <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-300">
                Subscribe
            </button>
        </div>
        
        <?php if ($enable_privacy_features && ($privacy_policy_url || $terms_of_service_url)) : ?>
            <div class="mt-2 text-xs text-gray-400">
                <input type="checkbox" id="newsletter-privacy-consent" name="privacy_consent" required>
                <label for="newsletter-privacy-consent">
                    <?php 
                    if ($privacy_policy_url && $terms_of_service_url) {
                        echo 'I agree to the <a href="' . esc_url($privacy_policy_url) . '" target="_blank">Privacy Policy</a> and <a href="' . esc_url($terms_of_service_url) . '" target="_blank">Terms of Service</a>';
                    } elseif ($privacy_policy_url) {
                        echo 'I agree to the <a href="' . esc_url($privacy_policy_url) . '" target="_blank">Privacy Policy</a>';
                    } elseif ($terms_of_service_url) {
                        echo 'I agree to the <a href="' . esc_url($terms_of_service_url) . '" target="_blank">Terms of Service</a>';
                    }
                    ?>
                </label>
            </div>
        <?php endif; ?>
        
        <div id="newsletter-message" class="mt-2 text-sm hidden"></div>
        <?php wp_nonce_field('yiontech_lms_newsletter_nonce', 'nonce'); ?>
    </form>
</div>
<?php endif; ?>

===== ./template-parts/footer-menu-widget.php =====

<?php
/**
 * Footer menu widget template
 *
 * @package Yiontech_LMS
 */

// Args for the menu
$menu_args = array(
    'theme_location' => isset($args['menu_location']) ? $args['menu_location'] : 'footer',
    'menu_class'     => isset($args['menu_class']) ? $args['menu_class'] : 'space-y-2',
    'container'      => false,
    'fallback_cb'    => false,
    'echo'           => true,
);

// Display the menu
wp_nav_menu($menu_args);

===== ./template-parts/content-none.php =====

<div class="bg-white rounded-lg shadow-md p-8 text-center">
    <h2 class="text-2xl font-bold mb-4"><?php _e('Nothing Found', 'yiontech-lms'); ?></h2>
    <?php if (is_home() && current_user_can('publish_posts')) : ?>
        <p class="mb-4"><?php printf(__('Ready to publish your first course? <a href="%s" class="text-blue-600 hover:underline">Get started here</a>.', 'yiontech-lms'), esc_url(admin_url('post-new.php'))); ?></p>
    <?php elseif (is_search()) : ?>
        <p class="mb-4"><?php _e('Sorry, but nothing matched your search terms. Please try again with some different keywords.', 'yiontech-lms'); ?></p>
        <?php get_search_form(); ?>
    <?php else : ?>
        <p class="mb-4"><?php _e('It seems we can&rsquo;t find what you&rsquo;re looking for. Perhaps searching can help.', 'yiontech-lms'); ?></p>
        <?php get_search_form(); ?>
    <?php endif; ?>
</div>

===== ./template-parts/content-course.php =====

<?php
/**
 * Template part for displaying course content in the course archive page
 *
 * @link https://developer.wordpress.org/themes/basics/template-hierarchy/
 *
 * @package Yiontech_LMS
 */
?>

<article id="post-<?php the_ID(); ?>" <?php post_class('bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-300 hover:shadow-lg hover:-translate-y-1'); ?>>
    <?php if (has_post_thumbnail()) : ?>
        <div class="course-thumbnail h-48 overflow-hidden">
            <?php the_post_thumbnail('medium', array('class' => 'w-full h-full object-cover')); ?>
        </div>
    <?php endif; ?>
    
    <div class="p-6">
        <header>
            <h2 class="text-xl font-bold mb-2"><a href="<?php the_permalink(); ?>" class="text-blue-600 hover:text-blue-800"><?php the_title(); ?></a></h2>
            <div class="flex items-center text-gray-600 text-sm mb-3">
                <?php
                // Display course instructor if Tutor LMS is active
                if (function_exists('tutor_utils')) {
                    $instructor_id = get_post_field('post_author', get_the_ID());
                    ?>
                    <span>by <?php echo get_the_author_meta('display_name', $instructor_id); ?></span>
                    <span class="mx-2">•</span>
                    <?php
                }
                ?>
                <span><?php echo get_the_date(); ?></span>
            </div>
        </header>
        
        <div class="content mb-4">
            <?php the_excerpt(); ?>
        </div>
        
        <div class="flex items-center justify-between mb-4">
            <?php
            // Display course rating if Tutor LMS is active
            if (function_exists('tutor_utils')) {
                $course_rating = tutor_utils()->get_course_rating();
                if ($course_rating->rating_count > 0) {
                    ?>
                    <div class="flex items-center">
                        <div class="flex text-yellow-400">
                            <?php for ($i = 1; $i <= 5; $i++) : ?>
                                <?php if ($i <= round($course_rating->rating_avg)) : ?>
                                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                    </svg>
                                <?php else : ?>
                                    <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                    </svg>
                                <?php endif; ?>
                            <?php endfor; ?>
                        </div>
                        <span class="text-sm text-gray-600 ml-1">(<?php echo $course_rating->rating_count; ?>)</span>
                    </div>
                    <?php
                }
            }
            ?>
            
            <?php
            // Display course price if Tutor LMS is active
            if (function_exists('tutor_utils')) {
                $price = tutor_utils()->get_course_price();
                if ($price) {
                    ?>
                    <div class="text-lg font-bold text-blue-600">
                        <?php echo $price; ?>
                    </div>
                    <?php
                }
            }
            ?>
        </div>
        
        <footer>
            <a href="<?php the_permalink(); ?>" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded transition duration-300">View Course</a>
        </footer>
    </div>
</article>

===== ./template-parts/content.php =====

<article id="post-<?php the_ID(); ?>" <?php post_class('bg-white rounded-lg shadow-md overflow-hidden'); ?>>
    <?php if (has_post_thumbnail()) : ?>
        <div class="post-thumbnail h-48 overflow-hidden">
            <?php the_post_thumbnail('medium', array('class' => 'w-full h-full object-cover')); ?>
        </div>
    <?php endif; ?>
    
    <div class="p-6">
        <header>
            <h2 class="text-xl font-bold mb-2"><a href="<?php the_permalink(); ?>" class="text-blue-600 hover:text-blue-800"><?php the_title(); ?></a></h2>
            <div class="text-gray-600 text-sm mb-3">
                <?php echo get_the_date(); ?> by <?php the_author(); ?>
            </div>
        </header>
        
        <div class="content mb-4">
            <?php the_excerpt(); ?>
        </div>
        
        <footer>
            <a href="<?php the_permalink(); ?>" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded">View Course</a>
        </footer>
    </div>
</article>

===== ./page-profile.php =====

<?php
/**
 * Template Name: User Profile Page
 *
 * @package Yiontech_LMS
 */

// Add custom body class
add_filter('body_class', function($classes) {
    $classes[] = 'profile-page';
    return $classes;
});

get_header();
?>

<div class="site-content">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="flex justify-center">
            <div class="w-full md:w-3/4">
                <?php echo do_shortcode('[user_profile]'); ?>
            </div>
        </div>
    </div>
</div>

<?php get_footer(); ?>

===== ./js/newsletter.js =====

(function($) {
    'use strict';
    
    $(document).ready(function() {
        $('#newsletter-form').on('submit', function(e) {
            e.preventDefault();
            
            var $form = $(this);
            var $message = $('#newsletter-message');
            var $submit = $form.find('button[type="submit"]');
            var originalText = $submit.text();
            
            // Show loading state
            $submit.prop('disabled', true).text('Subscribing...');
            $message.removeClass('hidden').removeClass('text-green-600 text-red-600').addClass('text-gray-600').text('Processing...');
            
            // Get form data
            var formData = $form.serialize();
            
            // Send AJAX request
            $.ajax({
                type: 'POST',
                url: yiontech_lms_newsletter.ajax_url,
                data: formData + '&action=yiontech_lms_newsletter',
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        $message.removeClass('text-gray-600 text-red-600').addClass('text-green-600').text(yiontech_lms_newsletter.success_message);
                        $form[0].reset();
                    } else {
                        $message.removeClass('text-gray-600 text-green-600').addClass('text-red-600').text(response.data);
                    }
                },
                error: function() {
                    $message.removeClass('text-gray-600 text-green-600').addClass('text-red-600').text('Subscription failed. Please try again.');
                },
                complete: function() {
                    $submit.prop('disabled', false).text(originalText);
                }
            });
        });
    });
    
})(jQuery);

===== ./js/admin.js =====

(function($) {
    'use strict';

    $(document).ready(function() {
        // Initialize color picker fields
        $('.yiontech-color-field').wpColorPicker();

        // Media upload functionality
        $(document).on('click', '.media-upload-button', function(e) {
            e.preventDefault();
            
            var button = $(this);
            var fieldContainer = button.closest('.media-field');
            var fieldId = fieldContainer.data('field-id');
            var preview = fieldContainer.find('.media-preview');
            var removeButton = fieldContainer.find('.media-remove-button');
            
            // Create media uploader
            var mediaUploader = wp.media({
                title: 'Select Image',
                button: {
                    text: 'Use this image'
                },
                multiple: false
            });
            
            // When an image is selected
            mediaUploader.on('select', function() {
                var attachment = mediaUploader.state().get('selection').first().toJSON();
                
                // Update hidden field with image URL
                fieldContainer.find('input[type="hidden"]').val(attachment.url);
                
                // Update preview
                preview.html('<img src="' + attachment.url + '" alt="" style="max-width: 200px; max-height: 100px;" />');
                
                // Show remove button
                removeButton.show();
                
                // Close the media uploader
                mediaUploader.close();
            });
            
            // Open the media uploader
            mediaUploader.open();
        });

        // Remove media functionality
        $(document).on('click', '.media-remove-button', function(e) {
            e.preventDefault();
            
            var button = $(this);
            var fieldContainer = button.closest('.media-field');
            var preview = fieldContainer.find('.media-preview');
            
            // Clear hidden field
            fieldContainer.find('input[type="hidden"]').val('');
            
            // Clear preview
            preview.html('');
            
            // Hide remove button
            button.hide();
        });

        // Header buttons functionality
        $(document).on('click', '.header-buttons-field .add-button', function(e) {
            e.preventDefault();
            
            var container = $(this).closest('.header-buttons-field');
            var buttonsContainer = container.find('.header-buttons');
            var fieldName = container.data('field-name');
            var counter = container.find('.item-counter');
            var index = parseInt(counter.val());
            
            // Create new button HTML
            var newButtonHtml = '<div class="header-button-item" data-index="' + index + '">';
            newButtonHtml += '<div><label>Button Text:</label><input type="text" name="' + fieldName + '[' + index + '][text]" class="regular-text" /></div>';
            newButtonHtml += '<div><label>Button URL:</label><input type="text" name="' + fieldName + '[' + index + '][url]" class="regular-text" /></div>';
            newButtonHtml += '<div><label>Button Style:</label><select name="' + fieldName + '[' + index + '][style]"><option value="solid">Solid</option><option value="outline">Outline</option></select></div>';
            newButtonHtml += '<div><label><input type="checkbox" name="' + fieldName + '[' + index + '][show_desktop]" value="1" checked /> Show on Desktop</label></div>';
            newButtonHtml += '<div><label><input type="checkbox" name="' + fieldName + '[' + index + '][show_mobile]" value="1" checked /> Show on Mobile</label></div>';
            newButtonHtml += '<button type="button" class="button remove-button">Remove Button</button>';
            newButtonHtml += '</div>';
            
            // Append new button
            buttonsContainer.append(newButtonHtml);
            
            // Update counter
            counter.val(index + 1);
        });

        // Remove header button
        $(document).on('click', '.header-button-item .remove-button', function(e) {
            e.preventDefault();
            $(this).closest('.header-button-item').remove();
        });

        // Menu items functionality
        $(document).on('click', '.menu-field .add-menu-item', function(e) {
            e.preventDefault();
            
            var container = $(this).closest('.menu-field');
            var menuContainer = container.find('.menu-items');
            var fieldName = container.data('field-name');
            var counter = container.find('.item-counter');
            var index = parseInt(counter.val());
            
            // Create new menu item HTML
            var newMenuItemHtml = '<div class="menu-item" data-index="' + index + '">';
            newMenuItemHtml += '<div><label>Menu Text:</label><input type="text" name="' + fieldName + '[' + index + '][text]" class="regular-text" /></div>';
            newMenuItemHtml += '<div><label>Menu URL:</label><input type="text" name="' + fieldName + '[' + index + '][url]" class="regular-text" /></div>';
            newMenuItemHtml += '<button type="button" class="button remove-menu-item">Remove</button>';
            newMenuItemHtml += '</div>';
            
            // Append new menu item
            menuContainer.append(newMenuItemHtml);
            
            // Update counter
            counter.val(index + 1);
        });

        // Remove menu item
        $(document).on('click', '.menu-item .remove-menu-item', function(e) {
            e.preventDefault();
            $(this).closest('.menu-item').remove();
        });

        // Footer links functionality
        $(document).on('click', '.footer-content-field .add-link', function(e) {
            e.preventDefault();
            
            var button = $(this);
            var column = button.data('column');
            var container = button.closest('.footer-content-field');
            var linksContainer = container.find('.footer-links[data-column="' + column + '"]');
            var fieldName = container.data('field-name');
            var counter = container.find('.item-counter[data-column="' + column + '"]');
            var index = parseInt(counter.val());
            
            // Create new link HTML
            var newLinkHtml = '<div class="footer-link-item" data-index="' + index + '">';
            newLinkHtml += '<input type="text" name="' + fieldName + '[' + column + '][links][' + index + '][text]" placeholder="Link Text" class="regular-text" />';
            newLinkHtml += '<input type="text" name="' + fieldName + '[' + column + '][links][' + index + '][url]" placeholder="Link URL" class="regular-text" />';
            newLinkHtml += '<button type="button" class="button remove-link">Remove</button>';
            newLinkHtml += '</div>';
            
            // Append new link
            linksContainer.append(newLinkHtml);
            
            // Update counter
            counter.val(index + 1);
        });

        // Remove footer link
        $(document).on('click', '.footer-link-item .remove-link', function(e) {
            e.preventDefault();
            $(this).closest('.footer-link-item').remove();
        });
        
        // Handle form submission to ensure proper checkbox handling
        $('form').on('submit', function() {
            // Ensure unchecked checkboxes are included in the form data
            $(this).find('input[type="checkbox"]').each(function() {
                var checkbox = $(this);
                var name = checkbox.attr('name');
                
                // If checkbox is not checked, add a hidden field with value 0
                if (!checkbox.is(':checked')) {
                    var hiddenField = $('<input>')
                        .attr('type', 'hidden')
                        .attr('name', name)
                        .val('0');
                    
                    checkbox.after(hiddenField);
                }
            });
        });
    });

})(jQuery);

===== ./js/user-profile.js =====

(function($) {
    'use strict';
    
    $(document).ready(function() {
        // Export user data
        $('#export-data').on('click', function(e) {
            e.preventDefault();
            
            // Send AJAX request
            $.ajax({
                type: 'POST',
                url: yiontech_lms_user_profile.ajax_url,
                data: {
                    action: 'yiontech_lms_export_user_data',
                    nonce: yiontech_lms_user_profile.nonce
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Create a temporary link to download the file
                        var link = document.createElement('a');
                        link.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(response.data, null, 2));
                        link.download = 'user-data-' + new Date().toISOString().slice(0, 10) + '.json';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        // Show success message
                        $('#profile-message').html('<div class="success-message">Your data has been exported successfully.</div>');
                    } else {
                        // Show error message
                        $('#profile-message').html('<div class="error-message">' + response.data + '</div>');
                    }
                },
                error: function() {
                    // Show error message
                    $('#profile-message').html('<div class="error-message">Failed to export your data. Please try again.</div>');
                }
            });
        });
        
        // Delete user account
        $('#delete-account').on('click', function(e) {
            e.preventDefault();
            
            // Confirm deletion
            if (confirm(yiontech_lms_user_profile.confirm_delete)) {
                // Send AJAX request
                $.ajax({
                    type: 'POST',
                    url: yiontech_lms_user_profile.ajax_url,
                    data: {
                        action: 'yiontech_lms_delete_user_account',
                        nonce: yiontech_lms_user_profile.nonce
                    },
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            // Show success message
                            $('#profile-message').html('<div class="success-message">' + response.data + '</div>');
                            
                            // Redirect to home page after a short delay
                            setTimeout(function() {
                                window.location.href = '<?php echo esc_url(home_url()); ?>';
                            }, 2000);
                        } else {
                            // Show error message
                            $('#profile-message').html('<div class="error-message">' + response.data + '</div>');
                        }
                    },
                    error: function() {
                        // Show error message
                        $('#profile-message').html('<div class="error-message">Failed to delete your account. Please try again.</div>');
                    }
                });
            }
        });
    });
    
})(jQuery);

===== ./js/preloader.js =====

/* ==========================
   Preloader Script
========================== */
(function ($) {
    'use strict';

    // Function to restore scroll position
    function restoreScrollPosition() {
        const scrollPosition = sessionStorage.getItem('scrollPosition');
        if (scrollPosition) {
            window.scrollTo(0, parseInt(scrollPosition));
            sessionStorage.removeItem('scrollPosition');
        }
    }

    $(window).on('load', function () {
        if ($('#preloader').length) {
            // Remove preloader immediately when content is loaded
            $('#preloader').fadeOut('slow', function () {
                $(this).remove();
                $('body').removeClass('preloader-active');
                
                // Restore scroll position after preloader is removed
                restoreScrollPosition();
                
                // Trigger event for other scripts that depend on preloader removal
                $(document).trigger('preloaderRemoved');
            });
        } else {
            $('body').removeClass('preloader-active');
            
            // Restore scroll position if no preloader
            restoreScrollPosition();
            
            // Trigger event for consistency
            $(document).trigger('preloaderRemoved');
        }
    });

    // Fallback in case window.load never triggers
    $(document).ready(function() {
        setTimeout(function() {
            if ($('#preloader').length && $('#preloader').is(':visible')) {
                $('#preloader').fadeOut('slow', function () {
                    $(this).remove();
                    $('body').removeClass('preloader-active');
                    
                    // Restore scroll position after preloader is removed
                    restoreScrollPosition();
                    
                    // Trigger event for other scripts that depend on preloader removal
                    $(document).trigger('preloaderRemoved');
                });
            } else if (!$('#preloader').length) {
                // Restore scroll position if no preloader
                restoreScrollPosition();
                
                // Trigger event for consistency
                $(document).trigger('preloaderRemoved');
            }
        }, 1000); // Reduced timeout to 1 second
    });

})(jQuery);

===== ./js/cookie-consent.js =====

(function($) {
    'use strict';
    
    $(document).ready(function() {
        // Cookie consent accept button
        $('#cookie-consent-accept').on('click', function(e) {
            e.preventDefault();
            
            // Send AJAX request
            $.ajax({
                type: 'POST',
                url: yiontech_lms_cookie_consent.ajax_url,
                data: {
                    action: 'yiontech_lms_cookie_consent',
                    nonce: yiontech_lms_cookie_consent.nonce
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Hide cookie consent banner
                        $('#cookie-consent-banner').fadeOut();
                        
                        // Set cookie for 1 year
                        var date = new Date();
                        date.setTime(date.getTime() + (365 * 24 * 60 * 60 * 1000));
                        var expires = "expires=" + date.toUTCString();
                        document.cookie = "yiontech_lms_cookie_consent=accepted;" + expires + ";path=/";
                    }
                },
                error: function() {
                    console.log('Cookie consent failed');
                }
            });
        });
    });
    
})(jQuery);

===== ./js/header-scroll.js =====

(function($) {
    'use strict';

    // Function to initialize header scroll functionality
    function initHeaderScroll() {
        const $header = $('.site-header');
        const $window = $(window);
        const stickyHeaderBackground = '<?php echo esc_js(yiontech_lms_get_theme_setting("sticky_header_background_color", "#1e40af")); ?>';
        const headerBackground = '<?php echo esc_js(yiontech_lms_get_theme_setting("header_background_color", "#1e40af")); ?>';
        const stickyHeader = '<?php echo esc_js(yiontech_lms_get_theme_setting("sticky_header", true)); ?>';
        const transparentHeader = '<?php echo esc_js(yiontech_lms_get_theme_setting("transparent_header", false)); ?>';

        // Only add scroll behavior if sticky header is enabled
        if (stickyHeader === '1') {
            // Set initial background without triggering transitions
            if (transparentHeader === '1' && $header.hasClass('header-transparent')) {
                $header.css({
                    'background-color': 'transparent',
                    'box-shadow': 'none'
                });
            } else {
                $header.css({
                    'background-color': headerBackground,
                    'box-shadow': 'none'
                });
            }
            
            // Force a reflow to apply the initial styles
            $header[0].offsetHeight;
            
            // Set initial state based on scroll position
            if ($window.scrollTop() > 50) {
                $header.css({
                    'background-color': stickyHeaderBackground,
                    'box-shadow': '0 4px 6px rgba(0, 0, 0, 0.1)'
                }).addClass('scrolled');
            }
            
            // Throttle scroll event for better performance
            let ticking = false;
            
            function updateHeader() {
                const scrollTop = $window.scrollTop();

                if (scrollTop > 50) {
                    $header.css({
                        'background-color': stickyHeaderBackground,
                        'box-shadow': '0 4px 6px rgba(0, 0, 0, 0.1)'
                    }).addClass('scrolled');
                } else {
                    if (transparentHeader === '1' && $header.hasClass('header-transparent')) {
                        $header.css({
                            'background-color': 'transparent',
                            'box-shadow': 'none'
                        }).removeClass('scrolled');
                    } else {
                        $header.css({
                            'background-color': headerBackground,
                            'box-shadow': 'none'
                        }).removeClass('scrolled');
                    }
                }
                
                ticking = false;
            }
            
            $window.on('scroll', function() {
                if (!ticking) {
                    window.requestAnimationFrame(function() {
                        updateHeader();
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        }
    }

    // Initialize header scroll in multiple scenarios
    
    // Scenario 1: After preloader is removed (if preloader is enabled)
    $(document).on('preloaderRemoved', function() {
        initHeaderScroll();
    });
    
    // Scenario 2: On document ready (if preloader is disabled)
    $(document).ready(function() {
        // Check if preloader exists
        var preloader = $('#preloader');
        
        // If preloader doesn't exist or is not visible, initialize header scroll immediately
        if (!preloader.length || preloader.is(':hidden')) {
            // Wait a bit to ensure all other scripts are loaded
            setTimeout(function() {
                initHeaderScroll();
            }, 100);
        }
    });
    
    // Scenario 3: Fallback - ensure header scroll is initialized even if other methods fail
    $(window).on('load', function() {
        // Check if header scroll is already initialized
        var $header = $('.site-header');
        if ($header.length && !$header.hasClass('header-scroll-initialized')) {
            setTimeout(function() {
                initHeaderScroll();
                $header.addClass('header-scroll-initialized');
            }, 500);
        }
    });

})(jQuery);

===== ./js/script.js =====

(function() {
    'use strict';
    
    document.addEventListener('DOMContentLoaded', function() {
        // Save scroll position before page unload
        window.addEventListener('beforeunload', function() {
            sessionStorage.setItem('scrollPosition', window.scrollY);
        });
        
        // Get elements
        const menuToggle = document.getElementById('mobile-menu-toggle');
        const menuClose = document.getElementById('mobile-menu-close');
        const menuSidebar = document.getElementById('mobile-menu-sidebar');
        const menuOverlay = document.getElementById('mobile-menu-overlay');
        const body = document.body;
        
        // Check if elements exist
        if (!menuToggle || !menuClose || !menuSidebar || !menuOverlay) {
            console.error('Mobile menu elements not found');
            return;
        }
        
        // Open menu function
        function openMenu() {
            menuSidebar.classList.remove('translate-x-full');
            menuOverlay.classList.remove('hidden');
            // Prevent body scroll to avoid layout shifts
            body.classList.add('mobile-menu-open');
        }
        
        // Close menu function
        function closeMenu() {
            menuSidebar.classList.add('translate-x-full');
            menuOverlay.classList.add('hidden');
            // Restore body scroll
            body.classList.remove('mobile-menu-open');
        }
        
        // Toggle menu on button click
        menuToggle.addEventListener('click', function(e) {
            e.preventDefault();
            if (menuSidebar.classList.contains('translate-x-full')) {
                openMenu();
            } else {
                closeMenu();
            }
        });
        
        // Close menu on close button click
        menuClose.addEventListener('click', function(e) {
            e.preventDefault();
            closeMenu();
        });
        
        // Close menu on overlay click
        menuOverlay.addEventListener('click', function(e) {
            e.preventDefault();
            closeMenu();
        });
        
        // Close menu on escape key press
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !menuSidebar.classList.contains('translate-x-full')) {
                closeMenu();
            }
        });
        
        // Close menu on window resize if desktop
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1280 && !menuSidebar.classList.contains('translate-x-full')) {
                closeMenu();
            }
        });
    });
})();

===== ./js/back-to-top.js =====

/* ==========================
   Back To Top Script
========================== */
(function ($) {
    'use strict';

    function initBackToTop() {
        var backToTop = $('#back-to-top');
        var scrollThreshold = 100;

        if (!backToTop.length) return;

        // Show/hide button
        function toggleButton() {
            if ($(window).scrollTop() > scrollThreshold) {
                backToTop.addClass('visible');
            } else {
                backToTop.removeClass('visible');
            }
        }

        // Scroll listener with requestAnimationFrame
        let ticking = false;
        $(window).on('scroll', function () {
            if (!ticking) {
                window.requestAnimationFrame(function () {
                    toggleButton();
                    ticking = false;
                });
                ticking = true;
            }
        });

        // Initial state
        toggleButton();

        // Smooth scroll to top
        backToTop.on('click', function (e) {
            e.preventDefault();
            $('html, body').animate({ scrollTop: 0 }, 800);
        });
    }

    $(document).ready(function () {
        initBackToTop();
    });

})(jQuery);

===== ./archive.php =====

<?php get_header(); ?>
<div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row">
        <div class="w-full md:w-2/3 md:pr-8">
            <header class="mb-6">
                <h1 class="text-3xl font-bold">
                    <?php
                    if (is_category()) :
                        single_cat_title();
                    elseif (is_tag()) :
                        single_tag_title();
                    elseif (is_author()) :
                        the_post();
                        echo 'Author Archives: ' . get_the_author();
                        rewind_posts();
                    elseif (is_day()) :
                        echo 'Daily Archives: ' . get_the_date();
                    elseif (is_month()) :
                        echo 'Monthly Archives: ' . get_the_date('F Y');
                    elseif (is_year()) :
                        echo 'Yearly Archives: ' . get_the_date('Y');
                    elseif (is_search()) :
                        echo 'Search Results for: ' . get_search_query();
                    else :
                        _e('Archives', 'yiontech-lms');
                    endif;
                    ?>
                </h1>
            </header>
            
            <?php if (have_posts()) : ?>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <?php while (have_posts()) : the_post(); ?>
                        <?php get_template_part('template-parts/content', get_post_format()); ?>
                    <?php endwhile; ?>
                </div>
                
                <div class="mt-8">
                    <?php the_posts_pagination(array(
                        'mid_size' => 2,
                        'prev_text' => __('&laquo; Previous', 'yiontech-lms'),
                        'next_text' => __('Next &raquo;', 'yiontech-lms'),
                    )); ?>
                </div>
            <?php else : ?>
                <?php get_template_part('template-parts/content', 'none'); ?>
            <?php endif; ?>
        </div>
        <div class="w-full md:w-1/3 mt-8 md:mt-0">
            <?php get_sidebar(); ?>
        </div>
    </div>
</div>
<?php get_footer(); ?>

===== ./page-login.php =====

<?php
/**
 * Template Name: Custom Login Page
 *
 * @package Yiontech_LMS
 */

// Add custom body class
add_filter('body_class', function($classes) {
    $classes[] = 'login-page';
    return $classes;
});

// Output minimal HTML structure for login page
get_header();
?>

<div class="site-content">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="flex justify-center">
            <div class="w-full md:w-2/3">
                <?php echo do_shortcode('[custom_login_form]'); ?>
            </div>
        </div>
    </div>
</div>

<?php get_footer(); ?>

===== ./footer.php =====

<?php
/**
 * Footer template for Yiontech LMS
 */

// Check if this is a login or register page
$is_auth_page = is_page_template('page-login.php') || is_page_template('page-register.php');

// Don't load footer for auth pages
if ($is_auth_page) {
    wp_footer();
    echo '</body></html>';
    return;
}
?>
<?php
$footer_style = yiontech_lms_get_theme_setting('footer_style', 'default');
$footer_content = yiontech_lms_get_theme_setting('footer_content');
$copyright_text = yiontech_lms_get_theme_setting('copyright_text', '&copy; ' . date('Y') . ' ' . get_bloginfo('name') . '. All rights reserved.');
$footer_text_color = yiontech_lms_get_theme_setting('footer_text_color', '#ffffff');
$footer_background_color = yiontech_lms_get_theme_setting('footer_background_color', '#111827');
$copyright_background_color = yiontech_lms_get_theme_setting('copyright_background_color', '#0f172a');
$footer_padding = yiontech_lms_get_theme_setting('footer_padding', array('top' => 48, 'bottom' => 48));
$padding_top = isset($footer_padding['top']) ? $footer_padding['top'] : 48;
$padding_bottom = isset($footer_padding['bottom']) ? $footer_padding['bottom'] : 48;
$logo = yiontech_lms_get_theme_setting('logo_upload');
$newsletter_enable = yiontech_lms_get_theme_setting('newsletter_enable');
$enable_back_to_top = yiontech_lms_get_theme_setting('enable_back_to_top');

// Get privacy settings
$enable_privacy_features = yiontech_lms_get_theme_setting('enable_privacy_features');
$privacy_policy_url = yiontech_lms_get_privacy_policy_url();
$terms_of_service_url = yiontech_lms_get_terms_of_service_url();

// Ensure footer_content is an array
if (!is_array($footer_content)) {
    $footer_content = array(
        'column1' => array(
            'title' => 'About Us',
            'content' => 'A powerful learning management system designed for educators and students.',
        ),
        'column2' => array(
            'title' => 'Quick Links',
            'links' => array(
                array('text' => 'Home', 'url' => '/'),
                array('text' => 'Courses', 'url' => '/courses'),
                array('text' => 'About', 'url' => '/about'),
                array('text' => 'Contact', 'url' => '/contact'),
            ),
        ),
        'column3' => array(
            'title' => 'Company',
            'links' => array(
                array('text' => 'About Us', 'url' => '/about'),
                array('text' => 'Our Team', 'url' => '/team'),
                array('text' => 'Careers', 'url' => '/careers'),
                array('text' => 'Blog', 'url' => '/blog'),
            ),
        ),
        'column4' => array(
            'title' => 'User Portal',
            'links' => array(
                array('text' => 'Login', 'url' => '/login'),
                array('text' => 'Register', 'url' => '/register'),
                array('text' => 'Dashboard', 'url' => '/dashboard'),
                array('text' => 'Profile', 'url' => '/profile'),
            ),
        ),
        'column5' => array(
            'title' => 'Newsletter',
            'content' => 'Get the latest news and updates delivered right to your inbox.',
            'email' => 'info@yiontech.com',
            'phone' => '+1 (555) 123-4567',
        ),
    );
}

// Ensure each column exists and has proper structure
$columns = array('column1', 'column2', 'column3', 'column4', 'column5');
foreach ($columns as $column) {
    if (!isset($footer_content[$column])) {
        $footer_content[$column] = array();
    }
    
    // Ensure title exists for each column
    if (!isset($footer_content[$column]['title'])) {
        $footer_content[$column]['title'] = '';
    }
    
    // Ensure content exists for column1 and column5
    if (($column === 'column1' || $column === 'column5') && !isset($footer_content[$column]['content'])) {
        $footer_content[$column]['content'] = '';
    }
    
    // Ensure links exist for column2, column3, and column4
    if (in_array($column, array('column2', 'column3', 'column4'))) {
        if (!isset($footer_content[$column]['links']) || !is_array($footer_content[$column]['links'])) {
            $footer_content[$column]['links'] = array();
        }
    }
    
    // Ensure email and phone exist for column5
    if ($column === 'column5') {
        if (!isset($footer_content[$column]['email'])) {
            $footer_content[$column]['email'] = '';
        }
        if (!isset($footer_content[$column]['phone'])) {
            $footer_content[$column]['phone'] = '';
        }
    }
}
?>
<?php if ($footer_style == 'default') : ?>
<footer class="text-white" style="background-color: <?php echo esc_attr($footer_background_color); ?>; color: <?php echo esc_attr($footer_text_color); ?>; ">
    <?php 
    if ( function_exists( 'elementor_theme_do_location' ) && elementor_theme_do_location( 'footer' ) ) {
        // Elementor footer
    } else {
        // Default theme footer
        ?>
        <div class="max-w-7xl  mx-auto px-4" style="padding-top: <?php echo esc_attr($padding_top); ?>px; padding-bottom: <?php echo esc_attr($padding_bottom); ?>px;">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-8">
                <!-- Column 1: Logo and Description -->
                <div>
                    <?php if ($logo) : ?>
                        <div class="mb-4">
                            <img src="<?php echo esc_url($logo); ?>" class="custom-logo" alt="<?php bloginfo('name'); ?>" style="max-height: 36px; width: auto;">
                        </div>
                    <?php elseif ( has_custom_logo() ) : ?>
                        <div class="mb-4">
                            <?php the_custom_logo(); ?>
                        </div>
                    <?php else : ?>
                        <h3 class="text-xl font-bold mb-4"><?php bloginfo( 'name' ); ?></h3>
                    <?php endif; ?>
                    <p class="text-gray-400 mb-4"><?php echo esc_html($footer_content['column1']['content']); ?></p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <!-- Column 2: Quick Links -->
                <div>
                    <h3 class="text-xl font-bold mb-4"><?php echo esc_html($footer_content['column2']['title']); ?></h3>
                    <ul class="space-y-2">
                        <?php if (!empty($footer_content['column2']['links']) && is_array($footer_content['column2']['links'])) : ?>
                            <?php foreach ($footer_content['column2']['links'] as $link) : ?>
                                <li>
                                    <a href="<?php echo esc_url($link['url']); ?>" class="text-gray-400 hover:text-white transition">
                                        <?php echo esc_html($link['text']); ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                        <?php endif; ?>
                        
                        <!-- Add privacy links if enabled -->
                        <?php if ($enable_privacy_features && $privacy_policy_url) : ?>
                            <li>
                                <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-gray-400 hover:text-white transition">
                                    Privacy Policy
                                </a>
                            </li>
                        <?php endif; ?>
                        
                        <?php if ($enable_privacy_features && $terms_of_service_url) : ?>
                            <li>
                                <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-gray-400 hover:text-white transition">
                                    Terms of Service
                                </a>
                            </li>
                        <?php endif; ?>
                    </ul>
                </div>
                
                <!-- Column 3: Company -->
                <div>
                    <h3 class="text-xl font-bold mb-4"><?php echo esc_html($footer_content['column3']['title']); ?></h3>
                    <ul class="space-y-2">
                        <?php if (!empty($footer_content['column3']['links']) && is_array($footer_content['column3']['links'])) : ?>
                            <?php foreach ($footer_content['column3']['links'] as $link) : ?>
                                <li>
                                    <a href="<?php echo esc_url($link['url']); ?>" class="text-gray-400 hover:text-white transition">
                                        <?php echo esc_html($link['text']); ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </ul>
                </div>
                
                <!-- Column 4: User Portal -->
                <div>
                    <h3 class="text-xl font-bold mb-4"><?php echo esc_html($footer_content['column4']['title']); ?></h3>
                    <ul class="space-y-2">
                        <?php if (!empty($footer_content['column4']['links']) && is_array($footer_content['column4']['links'])) : ?>
                            <?php foreach ($footer_content['column4']['links'] as $link) : ?>
                                <li>
                                    <a href="<?php echo esc_url($link['url']); ?>" class="text-gray-400 hover:text-white transition">
                                        <?php echo esc_html($link['text']); ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </ul>
                </div>
                
                <!-- Column 5: Newsletter -->
                <div>
                    <h3 class="text-xl font-bold mb-4"><?php echo esc_html($footer_content['column5']['title']); ?></h3>
                    <p class="text-gray-400 mb-4"><?php echo esc_html($footer_content['column5']['content']); ?></p>
                    <?php if ($newsletter_enable) : ?>
                        <?php get_template_part('template-parts/newsletter-form'); ?>
                    <?php endif; ?>
                    
                    <div class="mt-6">
                        <h4 class="text-lg font-medium mb-2">Contact Us</h4>
                        <ul class="space-y-2 text-gray-400">
                            <li class="flex items-start">
                                <svg class="w-5 h-5 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                <span><?php echo esc_html($footer_content['column5']['email']); ?></span>
                            </li>
                            <li class="flex items-start">
                                <svg class="w-5 h-5 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                                <span><?php echo esc_html($footer_content['column5']['phone']); ?></span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <?php
    }
    ?>
    
    <!-- Copyright -->
    <div class="mt-0  text-center text-gray-400" style="background-color: <?php echo esc_attr($copyright_background_color); ?>;">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <p><?php echo $copyright_text; ?></p>
            
            <!-- Add privacy links if enabled -->
            <?php if ($enable_privacy_features && ($privacy_policy_url || $terms_of_service_url)) : ?>
                <p class="mt-2 text-sm">
                    <?php if ($privacy_policy_url) : ?>
                        <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-gray-400 hover:text-white transition">
                            Privacy Policy
                        </a>
                    <?php endif; ?>
                    
                    <?php if ($privacy_policy_url && $terms_of_service_url) : ?>
                        <span class="mx-2">|</span>
                    <?php endif; ?>
                    
                    <?php if ($terms_of_service_url) : ?>
                        <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-gray-400 hover:text-white transition">
                            Terms of Service
                        </a>
                    <?php endif; ?>
                </p>
            <?php endif; ?>
        </div>
    </div>
</footer>
<?php elseif ($footer_style == 'minimal') : ?>
<footer class="text-white" style="background-color: <?php echo esc_attr($footer_background_color); ?>; color: <?php echo esc_attr($footer_text_color); ?>; padding-top: <?php echo esc_attr($padding_top); ?>px; padding-bottom: <?php echo esc_attr($padding_bottom); ?>px;">
    <?php 
    if ( function_exists( 'elementor_theme_do_location' ) && elementor_theme_do_location( 'footer' ) ) {
        // Elementor footer
    } else {
        // Minimal theme footer
        ?>
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <!-- Logo and Copyright -->
                <div class="mb-4 md:mb-0">
                    <?php if ($logo) : ?>
                        <div class="mb-2">
                            <img src="<?php echo esc_url($logo); ?>" class="custom-logo" alt="<?php bloginfo('name'); ?>" style="max-height: 36px; width: auto;">
                        </div>
                    <?php elseif ( has_custom_logo() ) : ?>
                        <div class="mb-2">
                            <?php the_custom_logo(); ?>
                        </div>
                    <?php else : ?>
                        <h3 class="text-xl font-bold mb-2"><?php bloginfo( 'name' ); ?></h3>
                    <?php endif; ?>
                    <p class="text-gray-400 text-sm"><?php echo $copyright_text; ?></p>
                </div>
                
                <!-- Quick Links -->
                <div class="mb-4 md:mb-0">
                    <ul class="flex flex-wrap justify-center gap-4">
                        <?php if (!empty($footer_content['column2']['links']) && is_array($footer_content['column2']['links'])) : ?>
                            <?php foreach ($footer_content['column2']['links'] as $link) : ?>
                                <li>
                                    <a href="<?php echo esc_url($link['url']); ?>" class="text-gray-400 hover:text-white transition">
                                        <?php echo esc_html($link['text']); ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                        <?php endif; ?>
                        
                        <!-- Add privacy links if enabled -->
                        <?php if ($enable_privacy_features && $privacy_policy_url) : ?>
                            <li>
                                <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-gray-400 hover:text-white transition">
                                    Privacy Policy
                                </a>
                            </li>
                        <?php endif; ?>
                        
                        <?php if ($enable_privacy_features && $terms_of_service_url) : ?>
                            <li>
                                <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-gray-400 hover:text-white transition">
                                    Terms of Service
                                </a>
                            </li>
                        <?php endif; ?>
                    </ul>
                </div>
                
                <!-- Social Media -->
                <div>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <?php
    }
    ?>
</footer>
<?php elseif ($footer_style == 'centered') : ?>
<footer class="text-white" style="background-color: <?php echo esc_attr($footer_background_color); ?>; color: <?php echo esc_attr($footer_text_color); ?>; padding-top: <?php echo esc_attr($padding_top); ?>px; padding-bottom: <?php echo esc_attr($padding_bottom); ?>px;">
    <?php 
    if ( function_exists( 'elementor_theme_do_location' ) && elementor_theme_do_location( 'footer' ) ) {
        // Elementor footer
    } else {
        // Centered theme footer
        ?>
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center">
                <!-- Logo -->
                <div class="mb-6">
                    <?php if ($logo) : ?>
                        <img src="<?php echo esc_url($logo); ?>" class="custom-logo mx-auto" alt="<?php bloginfo('name'); ?>" style="max-height: 36px; width: auto;">
                    <?php elseif ( has_custom_logo() ) : ?>
                        <div class="flex justify-center">
                            <?php the_custom_logo(); ?>
                        </div>
                    <?php else : ?>
                        <h3 class="text-xl font-bold mb-4"><?php bloginfo( 'name' ); ?></h3>
                    <?php endif; ?>
                </div>
                
                <!-- Description -->
                <p class="text-gray-400 max-w-2xl mx-auto mb-6"><?php echo esc_html($footer_content['column1']['content']); ?></p>
                
                <!-- Quick Links -->
                <div class="mb-6">
                    <ul class="flex flex-wrap justify-center gap-6">
                        <?php if (!empty($footer_content['column2']['links']) && is_array($footer_content['column2']['links'])) : ?>
                            <?php foreach ($footer_content['column2']['links'] as $link) : ?>
                                <li>
                                    <a href="<?php echo esc_url($link['url']); ?>" class="text-gray-400 hover:text-white transition">
                                        <?php echo esc_html($link['text']); ?>
                                    </a>
                                </li>
                            <?php endforeach; ?>
                        <?php endif; ?>
                        
                        <!-- Add privacy links if enabled -->
                        <?php if ($enable_privacy_features && $privacy_policy_url) : ?>
                            <li>
                                <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-gray-400 hover:text-white transition">
                                    Privacy Policy
                                </a>
                            </li>
                        <?php endif; ?>
                        
                        <?php if ($enable_privacy_features && $terms_of_service_url) : ?>
                            <li>
                                <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-gray-400 hover:text-white transition">
                                    Terms of Service
                                </a>
                            </li>
                        <?php endif; ?>
                    </ul>
                </div>
                
                <!-- Newsletter -->
                <?php if ($newsletter_enable) : ?>
                    <div class="mb-6 max-w-md mx-auto">
                        <?php get_template_part('template-parts/newsletter-form'); ?>
                    </div>
                <?php endif; ?>
                
                <!-- Social Media -->
                <div class="mb-6">
                    <div class="flex justify-center space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <!-- Contact Info -->
                <div class="text-gray-400 text-sm mb-6">
                    <p><?php echo esc_html($footer_content['column5']['email']); ?> | <?php echo esc_html($footer_content['column5']['phone']); ?></p>
                </div>
            </div>
        </div>
        
        <!-- Copyright -->
        <div class="mt-0 pt-6 text-center text-gray-400 text-sm" style="background-color: <?php echo esc_attr($copyright_background_color); ?>;">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <p><?php echo $copyright_text; ?></p>
                
                <!-- Add privacy links if enabled -->
                <?php if ($enable_privacy_features && ($privacy_policy_url || $terms_of_service_url)) : ?>
                    <p class="mt-2">
                        <?php if ($privacy_policy_url) : ?>
                            <a href="<?php echo esc_url($privacy_policy_url); ?>" class="text-gray-400 hover:text-white transition">
                                Privacy Policy
                            </a>
                        <?php endif; ?>
                        
                        <?php if ($privacy_policy_url && $terms_of_service_url) : ?>
                            <span class="mx-2">|</span>
                        <?php endif; ?>
                        
                        <?php if ($terms_of_service_url) : ?>
                            <a href="<?php echo esc_url($terms_of_service_url); ?>" class="text-gray-400 hover:text-white transition">
                                Terms of Service
                            </a>
                        <?php endif; ?>
                    </p>
                <?php endif; ?>
            </div>
        </div>
        <?php
    }
    ?>
</footer>
<?php endif; ?>


<!-- Back to top button - only show if enabled in theme settings -->
<?php if ($enable_back_to_top) : ?>
<a href="#" id="back-to-top" class="back-to-top">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
    </svg>
</a>
<?php endif; ?>

<?php wp_footer(); ?>
</body>
</html>

===== ./sidebar.php =====

<aside class="sidebar">
    <?php dynamic_sidebar('main-sidebar'); ?>
</aside>

===== ./404.php =====

<?php get_header(); ?>
<div class="container mx-auto px-4 py-16">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-8 text-center">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">404 - Page Not Found</h1>
        <p class="text-gray-600 mb-6">The page you are looking for might have been removed, had its name changed, or is temporarily unavailable.</p>
        <a href="<?php echo esc_url(home_url('/')); ?>" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded">Go to Homepage</a>
    </div>
</div>
<?php get_footer(); ?>

===== ./style.css =====

/*
Theme Name: Yiontech LMS
Theme URI: https://yiontech.com/
Author: Yiontech Team
Author URI: https://yiontech.com/
Description: A Learning Management System theme by Yiontech
Version: 1.0.0
License: GNU General Public License v2 or later
License URI: http://www.gnu.org/licenses/gpl-2.0.html
Text Domain: yiontech-lms
Tags: lms, education, e-learning, blog, custom-background, custom-logo, custom-menu, featured-images, threaded-comments, translation-ready

This theme, like WordPress, is licensed under the GPL.
Use it to make something cool, have fun, and share what you've learned.
*/

/* Reset and base styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html, body {
    height: 100%;
    overflow-x: hidden;
    width: 100%;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #fff;
    display: flex;
    flex-direction: column;
}

.site-content {
    flex: 1;
    overflow: hidden;
    width: 100%;
}

/* Custom Logo Size */
.custom-logo {
    max-height: 36px;
    width: auto;
}

/* Header Adjustments */
.site-header {
    padding: 0;
    border: none;
    box-shadow: none;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    z-index: 999;
}

.site-branding img {
    max-height: 36px;
    width: auto;
}

/* Navigation Menu */
.main-navigation ul {
    list-style: none;
    margin: 0;
    padding: 0;
    border: none;
}

.main-navigation ul li {
    position: relative;
    border: none;
}

.main-navigation ul li a {
    color: white;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    padding: 0.25rem 0;
    border: none;
}

.main-navigation ul li a:hover {
    color: rgba(255, 255, 255, 0.8);
    border: none;
}

/* Mobile Menu Toggle */
#mobile-menu-toggle {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
    transition: background-color 0.2s;
}

#mobile-menu-toggle:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Mobile Menu Sidebar */
#mobile-menu-sidebar {
    width: 80%;
    max-width: 320px;
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
    z-index: 9999;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
}

#mobile-menu-sidebar.translate-x-full {
    transform: translateX(100%);
}

#mobile-menu-sidebar:not(.translate-x-full) {
    transform: translateX(0);
}

#mobile-menu-sidebar ul {
    list-style: none;
    margin: 0;
    padding: 0;
    border: none;
}

#mobile-menu-sidebar ul li {
    margin-bottom: 0.5rem;
}

#mobile-menu-sidebar ul li a {
    color: #4B5563;
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 0;
    display: block;
    border: none;
    transition: color 0.3s ease;
}

#mobile-menu-sidebar ul li a:hover {
    color: #2563EB;
    border: none;
}

/* Mobile Menu Sections */
#mobile-menu-sidebar .border-b {
    border-bottom: 1px solid #E5E7EB;
}

#mobile-menu-sidebar h3 {
    color: #1F2937;
    font-weight: 600;
}

/* Mobile Menu Overlay */
#mobile-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9998;
}

/* Course Card Adjustments */
.course-thumbnail {
    height: 180px;
    border: none;
}

/* Pagination Adjustments */
.page-numbers {
    display: inline-block;
    padding: 0.5rem 0.75rem;
    margin: 0 0.25rem;
    border-radius: 0.375rem;
    background-color: #f3f4f6;
    color: #4b5563;
    text-decoration: none;
    border: none;
}

.page-numbers.current {
    background-color: #2563eb;
    color: white;
    border: none;
}

.page-numbers:hover {
    background-color: #e5e7eb;
    border: none;
}

.page-numbers.current:hover {
    background-color: #1d4ed8;
    border: none;
}

/* Footer Adjustments */
footer {
    border: none;
    box-shadow: none;
}

footer ul {
    list-style: none;
    margin: 0;
    padding: 0;
    border: none;
}

footer ul li {
    margin-bottom: 0.5rem;
}

footer ul li a {
    color: #9CA3AF;
    text-decoration: none;
    transition: color 0.3s ease;
    border: none;
    display: inline-block;
}

footer ul li a:hover {
    color: white;
    border: none;
}

/* Newsletter Form */
.newsletter-form input[type="email"] {
    background-color: #1F2937;
    border: 1px solid #374151;
}

.newsletter-form input[type="email"]:focus {
    border-color: #3B82F6;
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.newsletter-form button {
    background-color: #2563EB;
    border: none;
}

.newsletter-form button:hover {
    background-color: #1D4ED8;
}

/* Mobile Menu Newsletter Form */
#mobile-menu-sidebar form input[type="email"] {
    border: 1px solid #D1D5DB;
}

#mobile-menu-sidebar form input[type="email"]:focus {
    border-color: #3B82F6;
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#mobile-menu-sidebar form button {
    background-color: #2563EB;
    border: none;
}

#mobile-menu-sidebar form button:hover {
    background-color: #1D4ED8;
}

/* Preloader Styles */
#preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #ffffff;
    z-index: 99999 !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
}

.preloader-spinner {
    width: 80px;
    height: 80px;
    position: relative;
    display: block !important;
}

.spinner {
    width: 80px !important;
    height: 80px !important;
    border: 8px solid rgba(30, 64, 175, 0.2) !important;
    border-top: 8px solid #1e40af !important;
    border-radius: 50% !important;
    animation: spin 1s linear infinite !important;
    display: block !important;
    box-sizing: border-box !important;
    background-color: transparent !important;
}

/* Add a more visible spinner with multiple borders */
.spinner::before {
    content: "";
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    bottom: 5px;
    border-radius: 50%;
    border: 4px solid transparent;
    border-top-color: #3b82f6;
    animation: spin 2s linear infinite;
}

.spinner::after {
    content: "";
    position: absolute;
    top: 15px;
    left: 15px;
    right: 15px;
    bottom: 15px;
    border-radius: 50%;
    border: 2px solid transparent;
    border-top-color: #60a5fa;
    animation: spin 3s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Back to top button */
.back-to-top {
    position: fixed !important;
    bottom: 30px !important;
    right: 30px !important;
    background-color: #1e40af !important;
    color: white !important;
    width: 50px !important;
    height: 50px !important;
    border-radius: 50% !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    z-index: 99999 !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transition: opacity 0.3s, visibility 0.3s, transform 0.3s !important;
    transform: translateY(20px) !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
    cursor: pointer !important;
    text-decoration: none !important;
    pointer-events: none !important;
}

.back-to-top.visible {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) !important;
    pointer-events: auto !important;
}

.back-to-top:hover {
    background-color: #1e3a8a !important;
    transform: translateY(-5px) !important;
    text-decoration: none !important;
    color: white !important;
}

.back-to-top svg {
    width: 24px !important;
    height: 24px !important;
    pointer-events: none !important;
}

/* Sticky header styles */
.site-header.sticky {
    position: sticky;
    top: 0;
    z-index: 999;
    width: 100%;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.site-header.scrolled {
    background-color: #1e40af !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
}

/* Ensure body can scroll if needed */
html, body {
    height: auto;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Responsive adjustments */
@media (max-width: 1279px) {
    .site-header .flex.items-center.space-x-3 {
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: flex-end;
    }
    
    .site-header .flex.items-center.space-x-3 a {
        margin-left: 0.25rem;
    }
}

/* Fix for overflow issues */
.container, .max-w-7xl {
    overflow: hidden;
    width: 100%;
}

/* Remove all horizontal lines and unnecessary borders */
hr {
    display: none !important;
    border: none !important;
    margin: 0 !important;
    padding: 0 !important;
    height: 0 !important;
}

/* Remove borders from all elements */
* {
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    outline: none !important;
    box-shadow: none !important;
}

/* Remove borders from specific elements that might be causing the issue */
.site-header, footer, .site-content, .container, 
.main-navigation, .sidebar, .widget, .course-thumbnail,
.post-thumbnail, .content, .comments-area, .comment-list,
.comment-form, .page-links, .tagcloud, .wp-block,
.entry-content, .entry-header, .entry-footer, .entry-summary {
    border: none !important;
    border-top: none !important;
    border-bottom: none !important;
    border-left: none !important;
    border-right: none !important;
}

/* Remove any pseudo-elements that might be adding lines */
::before, ::after {
    border: none !important;
    border-top: none !important;
    border-bottom: none !important;
    border-left: none !important;
    border-right: none !important;
}

/* Remove any background images that might look like lines */
body, .site-header, footer, .site-content, .container {
    background-image: none !important;
}

/* Remove any box-shadows that might look like lines */
body, .site-header, footer, .site-content, .container,
.main-navigation, .sidebar, .widget, .course-thumbnail,
.post-thumbnail, .content, .comments-area, .comment-list,
.comment-form, .page-links, .tagcloud, .wp-block,
.entry-content, .entry-header, .entry-footer, .entry-summary {
    box-shadow: none !important;
}

/* Remove any text-decoration that might look like lines */
a, a:hover, a:focus, a:active {
    text-decoration: none !important;
    border-bottom: none !important;
}

/* Remove any outlines */
:focus {
    outline: none !important;
    outline-width: 0 !important;
    outline-style: none !important;
    outline-color: transparent !important;
}

/* Fix for layout shifts when mobile menu is open */
body.menu-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
}

/* Header scroll effect */
.site-header.scrolled {
    background-color: #1e40af !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
}

/* Add these styles at the end of the file */
/* Auth page specific styles */
.login-page, .register-page {
    background-color: #f9fafb;
}

.login-page .site-content, .register-page .site-content {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 0;
}

.login-page .custom-auth-form, .register-page .custom-auth-form {
    background: #fff;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    padding: 2rem;
    width: 100%;
    max-width: 28rem;
}

.login-page .custom-auth-form h2, .register-page .custom-auth-form h2 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #1f2937;
    font-size: 1.5rem;
    font-weight: 700;
}

.login-page .auth-form .form-group, .register-page .auth-form .form-group {
    margin-bottom: 1.25rem;
}

.login-page .auth-form label, .register-page .auth-form label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #374151;
}

.login-page .auth-form input[type="text"],
.login-page .auth-form input[type="email"],
.login-page .auth-form input[type="password"],
.login-page .auth-form input[type="tel"],
.register-page .auth-form input[type="text"],
.register-page .auth-form input[type="email"],
.register-page .auth-form input[type="password"],
.register-page .auth-form input[type="tel"],
.register-page .auth-form textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    font-size: 1rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.login-page .auth-form input:focus,
.register-page .auth-form input:focus,
.register-page .auth-form textarea:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.login-page .auth-form .button, .register-page .auth-form .button {
    display: block;
    width: 100%;
    padding: 0.75rem;
    background-color: #1e40af;
    color: white;
    border: none;
    border-radius: 0.375rem;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.15s ease-in-out;
}

.login-page .auth-form .button:hover, .register-page .auth-form .button:hover {
    background-color: #1e3a8a;
}

.login-page .auth-links, .register-page .auth-links {
    text-align: center;
    margin-top: 1.5rem;
    color: #6b7280;
}

.login-page .auth-links a, .register-page .auth-links a {
    color: #1e40af;
    text-decoration: none;
    font-weight: 500;
}

.login-page .auth-links a:hover, .register-page .auth-links a:hover {
    text-decoration: underline;
}

.login-page .auth-message, .register-page .auth-message {
    margin-top: 1rem;
    padding: 0.75rem;
    border-radius: 0.375rem;
    text-align: center;
}

.login-page .error-message, .register-page .error-message {
    background-color: #fee;
    color: #c33;
    border: 1px solid #fcc;
}

/* Fix for z-index conflicts between preloader, header, and back-to-top */
#preloader {
    z-index: 99999 !important;
}

.site-header {
    z-index: 1000 !important;
}

#mobile-menu-sidebar {
    z-index: 9999 !important;
}

#mobile-menu-overlay {
    z-index: 9998 !important;
}

.back-to-top {
    z-index: 998 !important;
}

/* Ensure proper loading sequence for components */
body.preloader-active #preloader {
    display: flex !important;
}

body.preloader-active .site-header {
    opacity: 0.9;
}

body.preloader-active .back-to-top {
    display: none !important;
}

/* Prevent scroll jump when transparent header is initialized */
body {
    overflow-x: hidden;
}

.site-header {
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

/* Fix for transparent header causing scroll reset */
.header-transparent {
    will-change: background-color;
}

/* Ensure smooth transitions for all header states */
.site-header.sticky {
    position: sticky;
    top: 0;
    z-index: 999;
    width: 100%;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

/* Prevent layout shifts during initialization */
html, body {
    height: auto;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Add preloader class to body when preloader is active */
body.preloader-active {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
}

/* Sticky header styles */
.site-header.header-sticky-enabled {
    position: sticky;
    top: 0;
    z-index: 999;
    width: 100%;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    will-change: transform;
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

.site-header.scrolled {
    background-color: #1e40af !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
}

/* Prevent layout shifts when mobile menu is open */
body.mobile-menu-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
}

/* SEO Optimizations */
/* Ensure proper heading structure */
h1, h2, h3, h4, h5, h6 {
    line-height: 1.2;
    margin-bottom: 1rem;
    font-weight: 600;
}

h1 {
    font-size: 2.5rem;
}

h2 {
    font-size: 2rem;
}

h3 {
    font-size: 1.75rem;
}

h4 {
    font-size: 1.5rem;
}

h5 {
    font-size: 1.25rem;
}

h6 {
    font-size: 1rem;
}

/* Image optimizations */
img {
    max-width: 100%;
    height: auto;
    border-style: none;
}

/* GDPR Cookie Consent */
.cookie-consent {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #1e40af;
    color: white;
    padding: 1rem;
    z-index: 100000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
}

.cookie-consent-content {
    flex: 1;
    padding-right: 1rem;
}

.cookie-consent-buttons {
    display: flex;
    gap: 0.5rem;
}

.cookie-consent-button {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 0.25rem;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.2s;
}

.cookie-consent-accept {
    background-color: white;
    color: #1e40af;
}

.cookie-consent-accept:hover {
    background-color: #f3f4f6;
}

.cookie-consent-decline {
    background-color: transparent;
    color: white;
    border: 1px solid white;
}

.cookie-consent-decline:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Accessibility improvements */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* Focus styles for accessibility */
a:focus, button:focus, input:focus, textarea:focus, select:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
}

/* Skip to content link for accessibility */
.skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: #1e40af;
    color: white;
    padding: 8px;
    z-index: 100000;
    text-decoration: none;
}

.skip-link:focus {
    top: 0;
}

/* Cookie consent banner */
.cookie-consent-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #1e293b;
    color: white;
    padding: 15px;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
}

.cookie-consent-content {
    flex: 1;
    margin-right: 15px;
}

.cookie-consent-buttons {
    display: flex;
    gap: 10px;
}

.cookie-consent-buttons .button {
    padding: 8px 16px;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    border: none;
}

.cookie-consent-accept {
    background: #3b82f6;
    color: white;
}

.cookie-consent-accept:hover {
    background: #2563eb;
}

.cookie-consent-learn {
    background: transparent;
    color: white;
    border: 1px solid white;
}

.cookie-consent-learn:hover {
    background: rgba(255,255,255,0.1);
}

/* Privacy consent checkbox */
.privacy-consent {
    margin-top: 15px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 4px;
}

.privacy-consent input[type="checkbox"] {
    margin-right: 10px;
}

.privacy-consent label {
    display: inline !important;
}

/* User profile page */
.user-profile {
    max-width: 800px;
    margin: 0 auto;
    padding: 30px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.profile-info {
    display: flex;
    margin-bottom: 30px;
}

.profile-image {
    flex: 0 0 150px;
    margin-right: 30px;
}

.profile-image img {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border-radius: 50%;
}

.placeholder-image {
    width: 150px;
    height: 150px;
    background: #f0f0f0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
}

.profile-details {
    flex: 1;
}

.profile-details h3 {
    margin-bottom: 15px;
}

.profile-details p {
    margin-bottom: 10px;
}

.user-documents {
    margin-bottom: 30px;
}

.user-documents ul {
    list-style: none;
    padding: 0;
}

.user-documents li {
    padding: 10px;
    border-bottom: 1px solid #eee;
}

.user-documents li:last-child {
    border-bottom: none;
}

.document-type {
    color: #666;
    font-size: 0.9em;
}

.profile-actions {
    text-align: center;
}

.profile-actions .button {
    margin: 0 5px;
}

/* Success and error messages */
.success-message {
    color: #155724;
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    padding: 10px;
    margin: 20px auto;
    max-width: 500px;
    border-radius: 4px;
    text-align: center;
}

.error-message {
    color: #721c24;
    background-color: #f8d7da;
    border: 1px solid #f5c6cb;
    padding: 10px;
    margin: 20px auto;
    max-width: 500px;
    border-radius: 4px;
    text-align: center;
}

===== ./functions.php =====

<?php
// Include theme settings
require_once get_template_directory() . '/admin/theme-settings.php';

// Theme setup
function yiontech_lms_setup() {
    // Add theme support
    add_theme_support('title-tag');
    add_theme_support('post-thumbnails');
    add_theme_support('custom-logo', array(
        'height'      => 36,
        'width'       => 120,
        'flex-height' => true,
        'flex-width'  => true,
    ));
    add_theme_support('html5', array('search-form', 'comment-form', 'comment-list', 'gallery', 'caption'));
    
    // Register navigation menus
    register_nav_menus(array(
        'primary' => __('Primary Menu', 'yiontech-lms'),
        'footer' => __('Footer Menu', 'yiontech-lms'),
        'footer-quick-links' => __('Footer Quick Links Menu', 'yiontech-lms'),
        'footer-company' => __('Footer Company Menu', 'yiontech-lms'),
        'footer-user-portal' => __('Footer User Portal Menu', 'yiontech-lms'),
    ));
    
    // Register sidebar
    register_sidebar(array(
        'name'          => __('Main Sidebar', 'yiontech-lms'),
        'id'            => 'main-sidebar',
        'description'   => __('Add widgets here.', 'yiontech-lms'),
        'before_widget' => '<div id="%1$s" class="widget %2$s mb-6 bg-white p-4 rounded-lg shadow">',
        'after_widget'  => '</div>',
        'before_title'  => '<h2 class="widget-title text-xl font-bold mb-3">',
        'after_title'   => '</h2>',
    ));
}
add_action('after_setup_theme', 'yiontech_lms_setup');

// Create front page on theme activation
add_action('after_switch_theme', 'yiontech_lms_create_front_page');
function yiontech_lms_create_front_page() {
    $front_page = get_page_by_path('front-page');
    if (!$front_page) {
        $front_page_id = wp_insert_post(array(
            'post_title'    => 'Front Page',
            'post_content'  => '',
            'post_status'   => 'publish',
            'post_author'   => 1,
            'post_type'     => 'page',
            'post_name'     => 'front-page'
        ));
        update_option('page_on_front', $front_page_id);
        update_option('show_on_front', 'page');
    }
}

// Enqueue scripts and styles
function yiontech_lms_scripts() {
    // Get theme version for cache busting
    $theme_version = wp_get_theme()->get('Version');
    
    wp_enqueue_style('yiontech-lms-style', get_stylesheet_uri(), array(), $theme_version);
    // Enqueue Tailwind CSS via CDN
    wp_enqueue_style('yiontech-lms-tailwind', 'https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css', array(), $theme_version);
    
    // Enqueue jQuery if it's not already loaded
    wp_enqueue_script('jquery');
    
    // Enqueue mobile menu script
    wp_enqueue_script('yiontech-lms-mobile-menu', get_template_directory_uri() . '/js/script.js', array('jquery'), $theme_version, true);
    
    // Enqueue preloader script if enabled
    $enable_preloader = yiontech_lms_get_theme_setting('enable_preloader');
    if ($enable_preloader) {
        wp_enqueue_script('yiontech-lms-preloader', get_template_directory_uri() . '/js/preloader.js', array('jquery'), $theme_version, true);
    }
    
    // Enqueue header scroll script if transparent header is enabled
    $transparent_header = yiontech_lms_get_theme_setting('transparent_header');
    $sticky_header = yiontech_lms_get_theme_setting('sticky_header');
    if ($transparent_header || $sticky_header) {
        wp_enqueue_script('yiontech-lms-header-scroll', get_template_directory_uri() . '/js/header-scroll.js', array('jquery'), $theme_version, true);
    }
    
    // Enqueue back-to-top script if enabled
    $enable_back_to_top = yiontech_lms_get_theme_setting('enable_back_to_top');
    if ($enable_back_to_top) {
        wp_enqueue_script('yiontech-lms-back-to-top', get_template_directory_uri() . '/js/back-to-top.js', array('jquery'), $theme_version, true);
    }
    
    // Enqueue newsletter script if enabled
    $newsletter_enable = yiontech_lms_get_theme_setting('newsletter_enable');
    if ($newsletter_enable) {
        wp_enqueue_script('yiontech-lms-newsletter', get_template_directory_uri() . '/js/newsletter.js', array('jquery'), $theme_version, true);
        wp_localize_script('yiontech_lms-newsletter', 'yiontech_lms_newsletter', array(
            'ajax_url' => admin_url('admin-ajax.php'),
            'success_message' => yiontech_lms_get_theme_setting('newsletter_success_message', 'Thank you for subscribing!'),
        ));
    }
    
    // Enqueue cookie consent script if privacy features are enabled
    $enable_privacy_features = yiontech_lms_get_theme_setting('enable_privacy_features');
    if ($enable_privacy_features) {
        wp_enqueue_script('yiontech-lms-cookie-consent', get_template_directory_uri() . '/js/cookie-consent.js', array('jquery'), $theme_version, true);
        wp_localize_script('yiontech_lms-cookie-consent', 'yiontech_lms_cookie_consent', array(
            'ajax_url' => admin_url('admin-ajax.php'),
            'cookie_consent_text' => yiontech_lms_get_theme_setting('cookie_consent_text', 'We use cookies to ensure you get the best experience on our website. By continuing to use this site, you consent to our use of cookies.'),
            'cookie_consent_button_text' => yiontech_lms_get_theme_setting('cookie_consent_button_text', 'Accept'),
            'cookie_consent_learn_more_text' => yiontech_lms_get_theme_setting('cookie_consent_learn_more_text', 'Learn More'),
            'privacy_policy_url' => get_privacy_policy_url(),
        ));
    }
    
    // Enqueue user profile script if on profile page
    if (is_page_template('page-profile.php')) {
        wp_enqueue_script('yiontech-lms-user-profile', get_template_directory_uri() . '/js/user-profile.js', array('jquery'), $theme_version, true);
        wp_localize_script('yiontech_lms-user-profile', 'yiontech_lms_user_profile', array(
            'ajax_url' => admin_url('admin-ajax.php'),
            'nonce' => wp_create_nonce('yiontech_lms_user_profile_nonce'),
            'confirm_delete' => __('Are you sure you want to delete your account? This action cannot be undone.', 'yiontech-lms'),
        ));
    }
    
    // Add inline script to prevent scroll jumps
    wp_add_inline_script('jquery', '
        jQuery(document).ready(function($) {
            // Store scroll position before any scripts run
            var scrollPosition = $(window).scrollTop();
            
            // Restore scroll position after all scripts are initialized
            $(window).on("load", function() {
                setTimeout(function() {
                    $(window).scrollTop(scrollPosition);
                }, 100);
            });
        });
    ');
}
add_action('wp_enqueue_scripts', 'yiontech_lms_scripts');

// Elementor compatibility
function yiontech_lms_elementor_setup() {
    // Add theme compatibility
    add_action('elementor/theme/register_locations', function($elementor_theme_manager) {
        $elementor_theme_manager->register_location('header');
        $elementor_theme_manager->register_location('footer');
    });
}
add_action('after_setup_theme', 'yiontech_lms_elementor_setup');

// Add custom image sizes for courses
add_action('after_setup_theme', 'yiontech_lms_add_image_sizes');
function yiontech_lms_add_image_sizes() {
    add_image_size('course-thumbnail', 400, 250, true);
}

// Full width for Elementor pages with Tailwind container width - CORRECTED VERSION
function yiontech_lms_elementor_full_width() {
    if (function_exists('\\Elementor\\Plugin')) {
        $document = \Elementor\Plugin::$instance->documents->get(get_the_ID());
        if ($document && $document->is_built_with_elementor()) {
            ?>
            <style>
                /* Only remove theme container constraints for Elementor pages */
                body.elementor-page .site-content > .container,
                body.elementor-page .site-content > .container > .flex,
                body.elementor-page .site-content > .container > .flex > div:first-child {
                    max-width: 100% !important;
                    width: 100% !important;
                    padding: 0 !important;
                    margin: 0 !important;
                }
                
                /* But preserve Elementor's own container settings */
                body.elementor-page .elementor-section.elementor-section-boxed > .elementor-container {
                    max-width: 1140px;
                    width: 100%;
                    padding-left: 15px;
                    padding-right: 15px;
                    margin-left: auto;
                    margin-right: auto;
                }
                
                /* Full width sections should remain full width */
                body.elementor-page .elementor-section.elementor-section-full_width > .elementor-container {
                    max-width: 100% !important;
                    padding-left: 0 !important;
                    padding-right: 0 !important;
                }
                
                /* Responsive adjustments */
                @media (min-width: 768px) {
                    body.elementor-page .elementor-section.elementor-section-boxed > .elementor-container {
                        max-width: 720px;
                    }
                }
                
                @media (min-width: 992px) {
                    body.elementor-page .elementor-section.elementor-section-boxed > .elementor-container {
                        max-width: 960px;
                    }
                }
                
                @media (min-width: 1200px) {
                    body.elementor-page .elementor-section.elementor-section-boxed > .elementor-container {
                        max-width: 1140px;
                    }
                }
            </style>
            <?php
        }
    }
}
add_action('wp_head', 'yiontech_lms_elementor_full_width');

// Add admin styles for theme settings
function yiontech_lms_admin_styles() {
    ?>
    <style>
        /* Improved admin styles for theme settings */
        .wrap h1 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .form-table {
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .form-table th {
            padding: 20px;
            background: #f9f9f9;
            border-bottom: 1px solid #eee;
            font-weight: 600;
        }
        
        .form-table td {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .form-table tr:last-child td {
            border-bottom: none;
        }
        
        input[type="text"], 
        input[type="email"], 
        input[type="url"], 
        input[type="password"], 
        input[type="number"], 
        textarea, 
        select {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.07);
        }
        
        input[type="color"] {
            height: 40px;
            width: 80px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        input[type="checkbox"] {
            margin-right: 10px;
        }
        
        .description {
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }
        
        .button {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            text-decoration: none;
        }
        
        .button-primary {
            background: #0085ba;
            color: #fff;
            border: 1px solid #0085ba;
        }
        
        .button-primary:hover {
            background: #0073a8;
            border-color: #0073a8;
        }
        
        .button-secondary {
            background: #f7f7f7;
            color: #555;
            border: 1px solid #ccc;
        }
        
        .button-secondary:hover {
            background: #f0f0f0;
            border-color: #999;
        }
        
        /* Media field styles */
        .media-field {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .media-preview {
            width: 200px;
            height: 100px;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f9f9f9;
            border-radius: 4px;
        }
        
        .media-preview img {
            max-width: 100%;
            max-height: 100%;
        }
        
        /* Header buttons field styles */
        .header-buttons-field, .menu-field {
            margin-top: 10px;
        }
        
        .header-buttons, .menu-items {
            margin-bottom: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            border-radius: 4px;
        }
        
        .header-button-item, .menu-item {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .header-button-item:last-child, .menu-item:last-child {
            margin-bottom: 0;
        }
        
        .header-button-item div, .menu-item div {
            margin-bottom: 10px;
        }
        
        .header-button-item div:last-child, .menu-item div:last-child {
            margin-bottom: 0;
        }
        
        .header-button-item label, .menu-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .remove-button, .remove-menu-item, .remove-link {
            background: #ff4d4d;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .remove-button:hover, .remove-menu-item:hover, .remove-link:hover {
            background: #ff1a1a;
        }
        
        .add-button, .add-menu-item, .add-link {
            background: #5cb85c;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .add-button:hover, .add-menu-item:hover, .add-link:hover {
            background: #4cae4c;
        }
        
        /* Footer content field styles */
        .footer-content-field h4 {
            margin: 20px 0 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            font-size: 16px;
            color: #23282d;
        }
        
        .footer-links {
            margin-bottom: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            border-radius: 4px;
        }
        
        .footer-link-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
        }
        
        .footer-link-item:last-child {
            margin-bottom: 0;
        }
        
        .footer-link-item input {
            flex: 1;
        }
        
        /* Spacing field styles */
        .spacing-field {
            display: flex;
            gap: 20px;
        }
        
        .spacing-field > div {
            flex: 1;
        }
        
        .spacing-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
    </style>
    <?php
}
add_action('admin_head', 'yiontech_lms_admin_styles');

// Newsletter AJAX handler
function yiontech_lms_newsletter_handler() {
    // Verify nonce
    if (!isset($_POST['nonce']) || !wp_verify_nonce($_POST['nonce'], 'yiontech_lms_newsletter_nonce')) {
        wp_send_json_error('Security check failed');
    }
    
    // Get newsletter settings
    $action_url = yiontech_lms_get_theme_setting('newsletter_action_url');
    $method = yiontech_lms_get_theme_setting('newsletter_method', 'post');
    $email_field = yiontech_lms_get_theme_setting('newsletter_email_field', 'email');
    $hidden_fields = yiontech_lms_get_theme_setting('newsletter_hidden_fields', '');
    
    // Get email from form
    $email = isset($_POST['email']) ? sanitize_email($_POST['email']) : '';
    
    if (empty($email)) {
        wp_send_json_error('Please enter a valid email address');
    }
    
    // Prepare data
    $data = array($email_field => $email);
    
    // Add hidden fields
    if (!empty($hidden_fields)) {
        $lines = explode("\n", $hidden_fields);
        foreach ($lines as $line) {
            $parts = explode('=', $line, 2);
            if (count($parts) == 2) {
                $data[trim($parts[0])] = trim($parts[1]);
            }
        }
    }
    
    // Send request
    $response = wp_remote_post($action_url, array(
        'method' => strtoupper($method),
        'body' => $data,
    ));
    
    // Check for errors
    if (is_wp_error($response)) {
        wp_send_json_error('Subscription failed. Please try again.');
    }
    
    // Get response code
    $response_code = wp_remote_retrieve_response_code($response);
    
    // Check response code
    if ($response_code >= 200 && $response_code < 300) {
        wp_send_json_success('Subscription successful');
    } else {
        wp_send_json_error('Subscription failed. Please try again.');
    }
}
add_action('wp_ajax_yiontech_lms_newsletter', 'yiontech_lms_newsletter_handler');
add_action('wp_ajax_nopriv_yiontech_lms_newsletter', 'yiontech_lms_newsletter_handler');

// Create custom login and registration pages
function yiontech_lms_create_custom_auth_pages() {
    // Check if pages already exist
    $login_page = get_page_by_path('login');
    $register_page = get_page_by_path('register');
    $profile_page = get_page_by_path('profile');
    $privacy_page = get_page_by_path('privacy-policy');
    $terms_page = get_page_by_path('terms-of-service');
    
    // Create login page if it doesn't exist
    if (!$login_page) {
        $login_page = array(
            'post_title'    => 'Login',
            'post_content'  => '[custom_login_form]',
            'post_status'   => 'publish',
            'post_author'   => 1,
            'post_type'     => 'page',
            'post_name'     => 'login'
        );
        wp_insert_post($login_page);
    }
    
    // Create registration page if it doesn't exist
    if (!$register_page) {
        $register_page = array(
            'post_title'    => 'Register',
            'post_content'  => '[custom_registration_form]',
            'post_status'   => 'publish',
            'post_author'   => 1,
            'post_type'     => 'page',
            'post_name'     => 'register'
        );
        wp_insert_post($register_page);
    }
    
    // Create profile page if it doesn't exist
    if (!$profile_page) {
        $profile_page = array(
            'post_title'    => 'Profile',
            'post_content'  => '[user_profile]',
            'post_status'   => 'publish',
            'post_author'   => 1,
            'post_type'     => 'page',
            'post_name'     => 'profile'
        );
        wp_insert_post($profile_page);
    }
    
    // Create privacy policy page if it doesn't exist
    if (!$privacy_page) {
        $privacy_page = array(
            'post_title'    => 'Privacy Policy',
            'post_content'  => 'This is the privacy policy page. Please update this content with your actual privacy policy.',
            'post_status'   => 'publish',
            'post_author'   => 1,
            'post_type'     => 'page',
            'post_name'     => 'privacy-policy'
        );
        $privacy_id = wp_insert_post($privacy_page);
        
        // Update privacy policy page setting
        $options = get_option('yiontech_lms_theme_settings', yiontech_lms_get_default_settings());
        $options['privacy_policy_page'] = $privacy_id;
        update_option('yiontech_lms_theme_settings', $options);
    }
    
    // Create terms of service page if it doesn't exist
    if (!$terms_page) {
        $terms_page = array(
            'post_title'    => 'Terms of Service',
            'post_content'  => 'This is the terms of service page. Please update this content with your actual terms of service.',
            'post_status'   => 'publish',
            'post_author'   => 1,
            'post_type'     => 'page',
            'post_name'     => 'terms-of-service'
        );
        $terms_id = wp_insert_post($terms_page);
        
        // Update terms of service page setting
        $options = get_option('yiontech_lms_theme_settings', yiontech_lms_get_default_settings());
        $options['terms_of_service_page'] = $terms_id;
        update_option('yiontech_lms_theme_settings', $options);
    }
}
add_action('after_setup_theme', 'yiontech_lms_create_custom_auth_pages');

// Shortcode for custom login form
function yiontech_lms_custom_login_form_shortcode() {
    if (is_user_logged_in()) {
        return '<p>You are already logged in.</p>';
    }
    
    ob_start();
    ?>
    <div class="custom-auth-form">
        <h2>Login to Your Account</h2>
        <form id="custom_login_form" class="auth-form" method="post">
            <div class="form-group">
                <label for="username">Username or Email</label>
                <input type="text" name="username" id="username" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" required>
            </div>
            <div class="form-group">
                <input type="checkbox" name="remember" id="remember">
                <label for="remember">Remember Me</label>
            </div>
            <div class="form-group">
                <input type="submit" name="login_submit" value="Login" class="button button-primary">
            </div>
            <p class="auth-links">
                <a href="<?php echo esc_url(wp_lostpassword_url()); ?>">Forgot Password?</a> | 
                <a href="<?php echo esc_url(get_permalink(get_page_by_path('register'))); ?>">Create Account</a>
            </p>
            <?php wp_nonce_field('custom_login_nonce', 'login_nonce'); ?>
        </form>
        <div id="login_message" class="auth-message"></div>
    </div>
    <?php
    return ob_get_clean();
}
add_shortcode('custom_login_form', 'yiontech_lms_custom_login_form_shortcode');

// Shortcode for custom registration form
function yiontech_lms_custom_registration_form_shortcode() {
    if (is_user_logged_in()) {
        return '<p>You are already registered and logged in.</p>';
    }
    
    // Get privacy settings
    $enable_privacy_features = yiontech_lms_get_theme_setting('enable_privacy_features');
    $privacy_policy_page = yiontech_lms_get_theme_setting('privacy_policy_page');
    $terms_of_service_page = yiontech_lms_get_theme_setting('terms_of_service_page');
    
    $privacy_policy_url = $privacy_policy_page ? get_permalink($privacy_policy_page) : '';
    $terms_of_service_url = $terms_of_service_page ? get_permalink($terms_of_service_page) : '';
    
    ob_start();
    ?>
    <div class="custom-auth-form">
        <h2>Create Your Account</h2>
        <form id="custom_registration_form" class="auth-form" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="reg_username">Username</label>
                <input type="text" name="reg_username" id="reg_username" required>
            </div>
            <div class="form-group">
                <label for="reg_email">Email</label>
                <input type="email" name="reg_email" id="reg_email" required>
            </div>
            <div class="form-group">
                <label for="reg_password">Password</label>
                <input type="password" name="reg_password" id="reg_password" required>
            </div>
            <div class="form-group">
                <label for="reg_confirm_password">Confirm Password</label>
                <input type="password" name="reg_confirm_password" id="reg_confirm_password" required>
            </div>
            <div class="form-group">
                <label for="reg_first_name">First Name</label>
                <input type="text" name="reg_first_name" id="reg_first_name">
            </div>
            <div class="form-group">
                <label for="reg_last_name">Last Name</label>
                <input type="text" name="reg_last_name" id="reg_last_name">
            </div>
            <div class="form-group">
                <label for="reg_phone">Phone Number</label>
                <input type="tel" name="reg_phone" id="reg_phone">
            </div>
            <div class="form-group">
                <label for="reg_bio">Bio</label>
                <textarea name="reg_bio" id="reg_bio" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label for="reg_profile_image">Profile Image</label>
                <input type="file" name="reg_profile_image" id="reg_profile_image" accept="image/*">
            </div>
            <div class="form-group">
                <label for="reg_documents">Documents</label>
                <input type="file" name="reg_documents[]" id="reg_documents" multiple accept=".pdf,.doc,.docx,.txt">
            </div>
            
            <?php if ($enable_privacy_features && ($privacy_policy_url || $terms_of_service_url)) : ?>
                <div class="form-group privacy-consent">
                    <?php if ($privacy_policy_url && $terms_of_service_url) : ?>
                        <input type="checkbox" name="privacy_consent" id="privacy_consent" required>
                        <label for="privacy_consent">I agree to the <a href="<?php echo esc_url($privacy_policy_url); ?>" target="_blank">Privacy Policy</a> and <a href="<?php echo esc_url($terms_of_service_url); ?>" target="_blank">Terms of Service</a></label>
                    <?php elseif ($privacy_policy_url) : ?>
                        <input type="checkbox" name="privacy_consent" id="privacy_consent" required>
                        <label for="privacy_consent">I agree to the <a href="<?php echo esc_url($privacy_policy_url); ?>" target="_blank">Privacy Policy</a></label>
                    <?php elseif ($terms_of_service_url) : ?>
                        <input type="checkbox" name="privacy_consent" id="privacy_consent" required>
                        <label for="privacy_consent">I agree to the <a href="<?php echo esc_url($terms_of_service_url); ?>" target="_blank">Terms of Service</a></label>
                    <?php endif; ?>
                </div>
            <?php endif; ?>
            
            <div class="form-group">
                <input type="submit" name="register_submit" value="Register" class="button button-primary">
            </div>
            <p class="auth-links">
                Already have an account? <a href="<?php echo esc_url(get_permalink(get_page_by_path('login'))); ?>">Login</a>
            </p>
            <?php wp_nonce_field('custom_registration_nonce', 'registration_nonce'); ?>
        </form>
        <div id="registration_message" class="auth-message"></div>
    </div>
    <?php
    return ob_get_clean();
}
add_shortcode('custom_registration_form', 'yiontech_lms_custom_registration_form_shortcode');

// Shortcode for user profile
function yiontech_lms_user_profile_shortcode() {
    if (!is_user_logged_in()) {
        return '<p>You need to login to view your profile.</p>';
    }
    
    $current_user = wp_get_current_user();
    $user_id = $current_user->ID;
    
    // Get user meta
    $phone = get_user_meta($user_id, 'phone', true);
    $bio = get_user_meta($user_id, 'bio', true);
    $profile_image_id = get_user_meta($user_id, 'profile_image_id', true);
    $profile_image_url = $profile_image_id ? wp_get_attachment_url($profile_image_id) : '';
    $documents = get_user_meta($user_id, 'documents', true);
    $documents = is_array($documents) ? $documents : array();
    
    // Get privacy settings
    $enable_data_export = yiontech_lms_get_theme_setting('enable_data_export');
    $enable_account_deletion = yiontech_lms_get_theme_setting('enable_account_deletion');
    
    ob_start();
    ?>
    <div class="user-profile">
        <h2>Your Profile</h2>
        <div class="profile-info">
            <div class="profile-image">
                <?php if ($profile_image_url) : ?>
                    <img src="<?php echo esc_url($profile_image_url); ?>" alt="Profile Image">
                <?php else : ?>
                    <div class="placeholder-image">No Image</div>
                <?php endif; ?>
            </div>
            <div class="profile-details">
                <h3><?php echo esc_html($current_user->display_name); ?></h3>
                <p><strong>Email:</strong> <?php echo esc_html($current_user->user_email); ?></p>
                <?php if ($phone) : ?>
                    <p><strong>Phone:</strong> <?php echo esc_html($phone); ?></p>
                <?php endif; ?>
                <?php if ($bio) : ?>
                    <p><strong>Bio:</strong> <?php echo esc_html($bio); ?></p>
                <?php endif; ?>
            </div>
        </div>
        
        <?php if (!empty($documents)) : ?>
            <div class="user-documents">
                <h3>Your Documents</h3>
                <ul>
                    <?php foreach ($documents as $document_id) : 
                        $document_url = wp_get_attachment_url($document_id);
                        $document_title = get_the_title($document_id);
                        $document_type = get_post_mime_type($document_id);
                        ?>
                        <li>
                            <a href="<?php echo esc_url($document_url); ?>" target="_blank">
                                <?php echo esc_html($document_title); ?>
                                <span class="document-type">(<?php echo esc_html($document_type); ?>)</span>
                            </a>
                        </li>
                    <?php endforeach; ?>
                </ul>
            </div>
        <?php endif; ?>
        
        <div class="profile-actions">
            <?php if ($enable_data_export) : ?>
                <button id="export-data" class="button button-secondary">Export My Data</button>
            <?php endif; ?>
            
            <?php if ($enable_account_deletion) : ?>
                <button id="delete-account" class="button" style="background-color: #dc3545; color: white;">Delete My Account</button>
            <?php endif; ?>
            
            <a href="<?php echo esc_url(wp_logout_url(home_url())); ?>" class="button button-secondary">Logout</a>
        </div>
        
        <div id="profile-message" class="auth-message"></div>
    </div>
    <?php
    return ob_get_clean();
}
add_shortcode('user_profile', 'yiontech_lms_user_profile_shortcode');

// Handle custom login
function yiontech_lms_handle_custom_login() {
    if (isset($_POST['login_submit']) && isset($_POST['login_nonce']) && wp_verify_nonce($_POST['login_nonce'], 'custom_login_nonce')) {
        $username = sanitize_user($_POST['username']);
        $password = $_POST['password'];
        $remember = isset($_POST['remember']) ? true : false;
        
        $creds = array(
            'user_login'    => $username,
            'user_password' => $password,
            'remember'      => $remember
        );
        
        $user = wp_signon($creds, false);
        
        if (is_wp_error($user)) {
            wp_redirect(add_query_arg('login', 'failed', get_permalink(get_page_by_path('login'))));
            exit;
        } else {
            wp_redirect(home_url());
            exit;
        }
    }
}
add_action('init', 'yiontech_lms_handle_custom_login');

// Handle custom registration
function yiontech_lms_handle_custom_registration() {
    if (isset($_POST['register_submit']) && isset($_POST['registration_nonce']) && wp_verify_nonce($_POST['registration_nonce'], 'custom_registration_nonce')) {
        $username = sanitize_user($_POST['reg_username']);
        $email = sanitize_email($_POST['reg_email']);
        $password = $_POST['reg_password'];
        $confirm_password = $_POST['reg_confirm_password'];
        $first_name = sanitize_text_field($_POST['reg_first_name']);
        $last_name = sanitize_text_field($_POST['reg_last_name']);
        $phone = sanitize_text_field($_POST['reg_phone']);
        $bio = sanitize_textarea_field($_POST['reg_bio']);
        
        // Validate passwords match
        if ($password !== $confirm_password) {
            wp_redirect(add_query_arg('registration', 'password_mismatch', get_permalink(get_page_by_path('register'))));
            exit;
        }
        
        // Create user
        $user_id = wp_create_user($username, $password, $email);
        
        if (is_wp_error($user_id)) {
            wp_redirect(add_query_arg('registration', 'failed', get_permalink(get_page_by_path('register'))));
            exit;
        }
        
        // Update user meta
        update_user_meta($user_id, 'first_name', $first_name);
        update_user_meta($user_id, 'last_name', $last_name);
        update_user_meta($user_id, 'phone', $phone);
        update_user_meta($user_id, 'bio', $bio);
        
        // Handle profile image upload
        if (!empty($_FILES['reg_profile_image']['name'])) {
            require_once(ABSPATH . 'wp-admin/includes/image.php');
            require_once(ABSPATH . 'wp-admin/includes/file.php');
            require_once(ABSPATH . 'wp-admin/includes/media.php');
            
            $attachment_id = media_handle_upload('reg_profile_image', 0);
            if (!is_wp_error($attachment_id)) {
                update_user_meta($user_id, 'profile_image_id', $attachment_id);
            }
        }
        
        // Handle documents upload
        if (!empty($_FILES['reg_documents']['name'][0])) {
            require_once(ABSPATH . 'wp-admin/includes/image.php');
            require_once(ABSPATH . 'wp-admin/includes/file.php');
            require_once(ABSPATH . 'wp-admin/includes/media.php');
            
            $documents = array();
            foreach ($_FILES['reg_documents']['name'] as $key => $value) {
                if ($_FILES['reg_documents']['name'][$key]) {
                    $file = array(
                        'name'     => $_FILES['reg_documents']['name'][$key],
                        'type'     => $_FILES['reg_documents']['type'][$key],
                        'tmp_name' => $_FILES['reg_documents']['tmp_name'][$key],
                        'error'    => $_FILES['reg_documents']['error'][$key],
                        'size'     => $_FILES['reg_documents']['size'][$key]
                    );
                    
                    $_FILES = array('reg_document' => $file);
                    $attachment_id = media_handle_upload('reg_document', 0);
                    
                    if (!is_wp_error($attachment_id)) {
                        $documents[] = $attachment_id;
                    }
                }
            }
            
            if (!empty($documents)) {
                update_user_meta($user_id, 'documents', $documents);
            }
        }
        
        // Log user in
        $creds = array(
            'user_login'    => $username,
            'user_password' => $password,
            'remember'      => true
        );
        
        wp_signon($creds, false);
        
        wp_redirect(get_permalink(get_page_by_path('profile')));
        exit;
    }
}
add_action('init', 'yiontech_lms_handle_custom_registration');

// Show login/registration messages
function yiontech_lms_show_auth_messages() {
    if (isset($_GET['login']) && $_GET['login'] == 'failed') {
        echo '<div class="error-message">Invalid username or password. Please try again.</div>';
    }
    
    if (isset($_GET['registration'])) {
        if ($_GET['registration'] == 'password_mismatch') {
            echo '<div class="error-message">Passwords do not match. Please try again.</div>';
        } elseif ($_GET['registration'] == 'failed') {
            echo '<div class="error-message">Registration failed. Please try again.</div>';
        }
    }
}
add_action('wp_footer', 'yiontech_lms_show_auth_messages');

// Add custom styles for auth forms
function yiontech_lms_auth_form_styles() {
    ?>
    <style>
        .custom-auth-form {
            max-width: 500px;
            margin: 0 auto;
            padding: 30px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .custom-auth-form h2 {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .auth-form .form-group {
            margin-bottom: 15px;
        }
        
        .auth-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .auth-form input[type="text"],
        .auth-form input[type="email"],
        .auth-form input[type="password"],
        .auth-form input[type="tel"],
        .auth-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .auth-form input[type="checkbox"] {
            margin-right: 5px;
        }
        
        .auth-form .button {
            display: inline-block;
            padding: 10px 20px;
            background: #1e40af;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .auth-form .button:hover {
            background: #1e3a8a;
        }
        
        .auth-links {
            margin-top: 20px;
            text-align: center;
        }
        
        .auth-message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        
        .error-message {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            margin: 20px auto;
            max-width: 500px;
            border-radius: 4px;
            text-align: center;
        }
        
        .user-profile {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .profile-info {
            display: flex;
            margin-bottom: 30px;
        }
        
        .profile-image {
            flex: 0 0 150px;
            margin-right: 30px;
        }
        
        .profile-image img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .placeholder-image {
            width: 150px;
            height: 150px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
        
        .profile-details {
            flex: 1;
        }
        
        .profile-details h3 {
            margin-bottom: 15px;
        }
        
        .profile-details p {
            margin-bottom: 10px;
        }
        
        .user-documents {
            margin-bottom: 30px;
        }
        
        .user-documents ul {
            list-style: none;
            padding: 0;
        }
        
        .user-documents li {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .user-documents li:last-child {
            border-bottom: none;
        }
        
        .document-type {
            color: #666;
            font-size: 0.9em;
        }
        
        .profile-actions {
            text-align: center;
        }
        
        .profile-actions .button {
            margin: 0 5px;
        }
        
        /* Privacy consent checkbox */
        .privacy-consent {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .privacy-consent input[type="checkbox"] {
            margin-right: 10px;
        }
        
        .privacy-consent label {
            display: inline !important;
        }
        
        /* Cookie consent banner */
        .cookie-consent-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1e293b;
            color: white;
            padding: 15px;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .cookie-consent-content {
            flex: 1;
            margin-right: 15px;
        }
        
        .cookie-consent-buttons {
            display: flex;
            gap: 10px;
        }
        
        .cookie-consent-buttons .button {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        
        .cookie-consent-accept {
            background: #3b82f6;
            color: white;
        }
        
        .cookie-consent-accept:hover {
            background: #2563eb;
        }
        
        .cookie-consent-learn {
            background: transparent;
            color: white;
            border: 1px solid white;
        }
        
        .cookie-consent-learn:hover {
            background: rgba(255,255,255,0.1);
        }
    </style>
    <?php
}
add_action('wp_head', 'yiontech_lms_auth_form_styles');

// Get privacy policy URL
function yiontech_lms_get_privacy_policy_url() {
    $privacy_policy_page = yiontech_lms_get_theme_setting('privacy_policy_page');
    if ($privacy_policy_page) {
        return get_permalink($privacy_policy_page);
    }
    return get_privacy_policy_url();
}

// Get terms of service URL
function yiontech_lms_get_terms_of_service_url() {
    $terms_of_service_page = yiontech_lms_get_theme_setting('terms_of_service_page');
    if ($terms_of_service_page) {
        return get_permalink($terms_of_service_page);
    }
    return '';
}

// Cookie consent AJAX handler
function yiontech_lms_cookie_consent_handler() {
    // Verify nonce
    if (!isset($_POST['nonce']) || !wp_verify_nonce($_POST['nonce'], 'yiontech_lms_cookie_consent_nonce')) {
        wp_send_json_error('Security check failed');
    }
    
    // Set cookie consent for 1 year
    setcookie('yiontech_lms_cookie_consent', 'accepted', time() + YEAR_IN_SECONDS, '/');
    
    wp_send_json_success('Cookie consent accepted');
}
add_action('wp_ajax_yiontech_lms_cookie_consent', 'yiontech_lms_cookie_consent_handler');
add_action('wp_ajax_nopriv_yiontech_lms_cookie_consent', 'yiontech_lms_cookie_consent_handler');

// Export user data
function yiontech_lms_export_user_data() {
    // Verify nonce
    if (!isset($_POST['nonce']) || !wp_verify_nonce($_POST['nonce'], 'yiontech_lms_user_profile_nonce')) {
        wp_send_json_error('Security check failed');
    }
    
    // Check if user is logged in
    if (!is_user_logged_in()) {
        wp_send_json_error('You must be logged in to export your data');
    }
    
    $current_user = wp_get_current_user();
    $user_id = $current_user->ID;
    
    // Get user data
    $user_data = get_userdata($user_id);
    
    // Get user meta
    $user_meta = get_user_meta($user_id);
    
    // Prepare data for export
    $export_data = array(
        'user_data' => array(
            'ID' => $user_data->ID,
            'user_login' => $user_data->user_login,
            'user_nicename' => $user_data->user_nicename,
            'user_email' => $user_data->user_email,
            'user_url' => $user_data->user_url,
            'user_registered' => $user_data->user_registered,
            'display_name' => $user_data->display_name,
        ),
        'user_meta' => $user_meta
    );
    
    // Convert to JSON
    $json_data = json_encode($export_data, JSON_PRETTY_PRINT);
    
    // Set headers for download
    header('Content-Type: application/json');
    header('Content-Disposition: attachment; filename="user-data-' . $user_id . '.json"');
    
    echo $json_data;
    exit;
}
add_action('wp_ajax_yiontech_lms_export_user_data', 'yiontech_lms_export_user_data');

// Delete user account
function yiontech_lms_delete_user_account() {
    // Verify nonce
    if (!isset($_POST['nonce']) || !wp_verify_nonce($_POST['nonce'], 'yiontech_lms_user_profile_nonce')) {
        wp_send_json_error('Security check failed');
    }
    
    // Check if user is logged in
    if (!is_user_logged_in()) {
        wp_send_json_error('You must be logged in to delete your account');
    }
    
    // Check if account deletion is enabled
    $enable_account_deletion = yiontech_lms_get_theme_setting('enable_account_deletion');
    if (!$enable_account_deletion) {
        wp_send_json_error('Account deletion is currently disabled');
    }
    
    $current_user = wp_get_current_user();
    $user_id = $current_user->ID;
    
    // Delete user
    require_once(ABSPATH . 'wp-admin/includes/user.php');
    $result = wp_delete_user($user_id);
    
    if ($result) {
        wp_send_json_success('Your account has been successfully deleted');
    } else {
        wp_send_json_error('Failed to delete your account');
    }
}
add_action('wp_ajax_yiontech_lms_delete_user_account', 'yiontech_lms_delete_user_account');

// Add cookie consent banner to footer
function yiontech_lms_cookie_consent_banner() {
    $enable_privacy_features = yiontech_lms_get_theme_setting('enable_privacy_features');
    
    if ($enable_privacy_features && !isset($_COOKIE['yiontech_lms_cookie_consent'])) {
        ?>
        <div id="cookie-consent-banner" class="cookie-consent-banner">
            <div class="cookie-consent-content">
                <?php echo wp_kses_post(yiontech_lms_get_theme_setting('cookie_consent_text', 'We use cookies to ensure you get the best experience on our website. By continuing to use this site, you consent to our use of cookies.')); ?>
            </div>
            <div class="cookie-consent-buttons">
                <a href="<?php echo esc_url(yiontech_lms_get_privacy_policy_url()); ?>" class="button cookie-consent-learn" target="_blank">
                    <?php echo esc_html(yiontech_lms_get_theme_setting('cookie_consent_learn_more_text', 'Learn More')); ?>
                </a>
                <button id="cookie-consent-accept" class="button cookie-consent-accept">
                    <?php echo esc_html(yiontech_lms_get_theme_setting('cookie_consent_button_text', 'Accept')); ?>
                </button>
            </div>
        </div>
        <?php
    }
}
add_action('wp_footer', 'yiontech_lms_cookie_consent_banner');

===== ./page.php =====

<?php get_header(); ?>
<div class="site-content w-full overflow-hidden">
    <?php 
    while (have_posts()) : the_post(); 
        if (function_exists('\\Elementor\\Plugin') 
            && \Elementor\Plugin::$instance->documents->get(get_the_ID())->is_built_with_elementor()) {
            
            // Elementor-built page → render directly
            the_content();

        } else {
            ?>
            
            <?php if (has_post_thumbnail()) : ?>
                <!-- Full width hero background -->
                <section class="relative w-full overflow-hidden">
                    <?php the_post_thumbnail('full', [
                        'class' => 'w-full h-[500px] object-cover'
                    ]); ?>

                    <!-- Content container inside hero -->
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="max-w-7xl mx-auto px-4 text-center">
                            <h1 class="text-4xl md:text-5xl font-bold text-white drop-shadow-lg">
                                <?php the_title(); ?>
                            </h1>
                        </div>
                    </div>
                </section>
            <?php endif; ?>
            
            <!-- Page content -->
            <div class="max-w-7xl mx-auto px-4 py-12 overflow-hidden">
                <article id="post-<?php the_ID(); ?>" <?php post_class('bg-white shadow-md rounded-lg overflow-hidden'); ?>>
                    
                    <div class="content p-6 prose max-w-none overflow-hidden">
                        <?php the_content(); ?>
                    </div>
                </article>
            </div>
            
            <?php
        }
    endwhile; 
    ?>
</div>
<?php get_footer(); ?>

===== ./css/admin.css =====

/* Theme Settings Page Styles */
.settings-container {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    padding: 20px;
    margin-top: 20px;
}

.settings-section {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
}

.settings-section:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.settings-section h2 {
    margin: 0 0 15px 0;
    padding: 0;
    font-size: 1.5em;
    color: #23282d;
}

.settings-section p {
    margin: 0 0 15px 0;
    color: #666;
    font-style: italic;
}

/* Form Table Styles */
.form-table {
    border-collapse: collapse;
    margin: 0;
    padding: 0;
    width: 100%;
}

.form-table th {
    vertical-align: top;
    text-align: left;
    padding: 20px 10px 20px 0;
    width: 200px;
    background: #f9f9f9;
    border-bottom: 1px solid #eee;
    font-weight: 600;
}

.form-table td {
    vertical-align: top;
    padding: 20px 10px;
    border-bottom: 1px solid #eee;
}

.form-table tr:last-child th,
.form-table tr:last-child td {
    border-bottom: none;
}

/* Form Field Styles */
input[type="text"],
input[type="email"],
input[type="url"],
input[type="number"],
textarea,
select {
    width: 100%;
    max-width: 400px;
    padding: 8px 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background-color: #fff;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.07);
    transition: border-color 0.15s ease-in-out;
}

input[type="text"]:focus,
input[type="email"]:focus,
input[type="url"]:focus,
input[type="number"]:focus,
textarea:focus,
select:focus {
    border-color: #00a0d2;
    outline: none;
    box-shadow: 0 0 0 1px #00a0d2;
}

input[type="color"] {
    height: 35px;
    width: 80px;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    vertical-align: middle;
}

input[type="checkbox"] {
    margin-right: 8px;
}

.description {
    color: #666;
    font-style: italic;
    margin-top: 5px;
    font-size: 13px;
}

/* Button Styles */
.button {
    display: inline-block;
    text-decoration: none;
    font-size: 13px;
    line-height: 26px;
    height: 28px;
    margin: 0;
    padding: 0 10px 1px;
    cursor: pointer;
    border-width: 1px;
    border-style: solid;
    -webkit-appearance: none;
    border-radius: 3px;
    white-space: nowrap;
    box-sizing: border-box;
    background: #f7f7f7;
    color: #555;
    border-color: #ccc;
    box-shadow: 0 1px 0 #ccc;
    vertical-align: top;
}

.button:hover,
.button:focus {
    background: #fafafa;
    border-color: #999;
    color: #23282d;
}

.button-primary {
    background: #0085ba;
    border-color: #0073a8;
    color: #fff;
    box-shadow: 0 1px 0 #0073a8;
    text-shadow: 0 -1px 1px #006799, 1px 0 1px #006799, 0 1px 1px #006799, -1px 0 1px #006799;
}

.button-primary:hover,
.button-primary:focus {
    background: #0073a8;
    border-color: #006799;
    color: #fff;
}

.button.remove-button,
.button.remove-menu-item,
.button.remove-link {
    background: #ff4d4d;
    border-color: #ff1a1a;
    color: #fff;
    box-shadow: 0 1px 0 #ff1a1a;
}

.button.remove-button:hover,
.button.remove-menu-item:hover,
.button.remove-link:hover {
    background: #ff1a1a;
    border-color: #e60000;
    color: #fff;
}

.button.add-button,
.button.add-menu-item,
.button.add-link {
    background: #5cb85c;
    border-color: #4cae4c;
    color: #fff;
    box-shadow: 0 1px 0 #4cae4c;
}

.button.add-button:hover,
.button.add-menu-item:hover,
.button.add-link:hover {
    background: #4cae4c;
    border-color: #3d8b3d;
    color: #fff;
}

/* Media Field Styles */
.media-field {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
}

.media-preview {
    width: 200px;
    height: 100px;
    border: 1px solid #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background: #f9f9f9;
    border-radius: 4px;
}

.media-preview img {
    max-width: 100%;
    max-height: 100%;
    height: auto;
}

/* Header Buttons Field Styles */
.header-buttons-field,
.menu-field {
    margin-top: 10px;
}

.header-buttons,
.menu-items {
    margin-bottom: 10px;
    max-height: 300px;
    overflow-y: auto;
    padding: 15px;
    border: 1px solid #ddd;
    background: #f9f9f9;
    border-radius: 4px;
}

.header-button-item,
.menu-item {
    margin-bottom: 15px;
    padding: 15px;
    border: 1px solid #ddd;
    background: #fff;
    border-radius: 4px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.header-button-item:last-child,
.menu-item:last-child {
    margin-bottom: 0;
}

.header-button-item div,
.menu-item div {
    margin-bottom: 10px;
}

.header-button-item div:last-child,
.menu-item div:last-child {
    margin-bottom: 0;
}

.header-button-item label,
.menu-item label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
}

/* Footer Content Field Styles */
.footer-content-field h4 {
    margin: 20px 0 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
    font-size: 16px;
    color: #23282d;
}

.footer-links {
    margin-bottom: 10px;
    max-height: 200px;
    overflow-y: auto;
    padding: 15px;
    border: 1px solid #ddd;
    background: #f9f9f9;
    border-radius: 4px;
}

.footer-link-item {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    background: #fff;
    border-radius: 4px;
}

.footer-link-item:last-child {
    margin-bottom: 0;
}

.footer-link-item input {
    flex: 1;
}

/* Spacing Field Styles */
.spacing-field {
    display: flex;
    gap: 20px;
}

.spacing-field > div {
    flex: 1;
}

.spacing-field label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
}

/* Item Counter (hidden field for tracking dynamic items) */
.item-counter {
    display: none;
}

===== ./css/fixes.css =====

/*
Theme Name: Yiontech LMS Fixes
Description: Fixes for theme layout and functionality issues
Version: 1.0.0
*/

/* Reset and base styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html, body {
    height: 100%;
    overflow-x: hidden;
    width: 100%;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #fff;
    display: flex;
    flex-direction: column;
}

.site-content {
    flex: 1;
    overflow: hidden;
    width: 100%;
}

/* Custom Logo Size */
.custom-logo {
    max-height: 36px;
    width: auto;
}

/* Header Adjustments */
.site-header {
    padding: 0;
    border: none;
    box-shadow: none;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    z-index: 999;
}

.site-branding img {
    max-height: 36px;
    width: auto;
}

/* Navigation Menu */
.main-navigation ul {
    list-style: none;
    margin: 0;
    padding: 0;
    border: none;
}

.main-navigation ul li {
    position: relative;
    border: none;
}

.main-navigation ul li a {
    color: white;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    padding: 0.25rem 0;
    border: none;
}

.main-navigation ul li a:hover {
    color: rgba(255, 255, 255, 0.8);
    border: none;
}

/* Mobile Menu Toggle */
#mobile-menu-toggle {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
    transition: background-color 0.2s;
}

#mobile-menu-toggle:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Mobile Menu Sidebar */
#mobile-menu-sidebar {
    width: 80%;
    max-width: 320px;
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
    z-index: 9999;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
}

#mobile-menu-sidebar.translate-x-full {
    transform: translateX(100%);
}

#mobile-menu-sidebar:not(.translate-x-full) {
    transform: translateX(0);
}

#mobile-menu-sidebar ul {
    list-style: none;
    margin: 0;
    padding: 0;
    border: none;
}

#mobile-menu-sidebar ul li {
    margin-bottom: 0.5rem;
}

#mobile-menu-sidebar ul li a {
    color: #4B5563;
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 0;
    display: block;
    border: none;
    transition: color 0.3s ease;
}

#mobile-menu-sidebar ul li a:hover {
    color: #2563EB;
    border: none;
}

/* Mobile Menu Sections */
#mobile-menu-sidebar .border-b {
    border-bottom: 1px solid #E5E7EB;
}

#mobile-menu-sidebar h3 {
    color: #1F2937;
    font-weight: 600;
}

/* Mobile Menu Overlay */
#mobile-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9998;
}

/* Course Card Adjustments */
.course-thumbnail {
    height: 180px;
    border: none;
}

/* Pagination Adjustments */
.page-numbers {
    display: inline-block;
    padding: 0.5rem 0.75rem;
    margin: 0 0.25rem;
    border-radius: 0.375rem;
    background-color: #f3f4f6;
    color: #4b5563;
    text-decoration: none;
    border: none;
}

.page-numbers.current {
    background-color: #2563eb;
    color: white;
    border: none;
}

.page-numbers:hover {
    background-color: #e5e7eb;
    border: none;
}

.page-numbers.current:hover {
    background-color: #1d4ed8;
    border: none;
}

/* Footer Adjustments */
footer {
    border: none;
    box-shadow: none;
}

footer ul {
    list-style: none;
    margin: 0;
    padding: 0;
    border: none;
}

footer ul li {
    margin-bottom: 0.5rem;
}

footer ul li a {
    color: #9CA3AF;
    text-decoration: none;
    transition: color 0.3s ease;
    border: none;
    display: inline-block;
}

footer ul li a:hover {
    color: white;
    border: none;
}

/* Newsletter Form */
.newsletter-form input[type="email"] {
    background-color: #1F2937;
    border: 1px solid #374151;
}

.newsletter-form input[type="email"]:focus {
    border-color: #3B82F6;
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.newsletter-form button {
    background-color: #2563EB;
    border: none;
}

.newsletter-form button:hover {
    background-color: #1D4ED8;
}

/* Mobile Menu Newsletter Form */
#mobile-menu-sidebar form input[type="email"] {
    border: 1px solid #D1D5DB;
}

#mobile-menu-sidebar form input[type="email"]:focus {
    border-color: #3B82F6;
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#mobile-menu-sidebar form button {
    background-color: #2563EB;
    border: none;
}

#mobile-menu-sidebar form button:hover {
    background-color: #1D4ED8;
}

/* Preloader Styles */
#preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #ffffff;
    z-index: 99999 !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
}

.preloader-spinner {
    width: 80px;
    height: 80px;
    position: relative;
    display: block !important;
}

.spinner {
    width: 80px !important;
    height: 80px !important;
    border: 8px solid rgba(30, 64, 175, 0.2) !important;
    border-top: 8px solid #1e40af !important;
    border-radius: 50% !important;
    animation: spin 1s linear infinite !important;
    display: block !important;
    box-sizing: border-box !important;
    background-color: transparent !important;
}

/* Add a more visible spinner with multiple borders */
.spinner::before {
    content: "";
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    bottom: 5px;
    border-radius: 50%;
    border: 4px solid transparent;
    border-top-color: #3b82f6;
    animation: spin 2s linear infinite;
}

.spinner::after {
    content: "";
    position: absolute;
    top: 15px;
    left: 15px;
    right: 15px;
    bottom: 15px;
    border-radius: 50%;
    border: 2px solid transparent;
    border-top-color: #60a5fa;
    animation: spin 3s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Back to top button */
.back-to-top {
    position: fixed !important;
    bottom: 30px !important;
    right: 30px !important;
    background-color: #1e40af !important;
    color: white !important;
    width: 50px !important;
    height: 50px !important;
    border-radius: 50% !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    z-index: 99999 !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transition: opacity 0.3s, visibility 0.3s, transform 0.3s !important;
    transform: translateY(20px) !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
    cursor: pointer !important;
    text-decoration: none !important;
    pointer-events: none !important;
}

.back-to-top.visible {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) !important;
    pointer-events: auto !important;
}

.back-to-top:hover {
    background-color: #1e3a8a !important;
    transform: translateY(-5px) !important;
    text-decoration: none !important;
    color: white !important;
}

.back-to-top svg {
    width: 24px !important;
    height: 24px !important;
    pointer-events: none !important;
}

/* Sticky header styles */
.site-header.sticky {
    position: sticky;
    top: 0;
    z-index: 999;
    width: 100%;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.site-header.scrolled {
    background-color: #1e40af !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
}

/* Ensure body can scroll if needed */
html, body {
    height: auto;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Responsive adjustments */
@media (max-width: 1279px) {
    .site-header .flex.items-center.space-x-3 {
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: flex-end;
    }
    
    .site-header .flex.items-center.space-x-3 a {
        margin-left: 0.25rem;
    }
}

/* Fix for overflow issues */
.container, .max-w-7xl {
    overflow: hidden;
    width: 100%;
}

/* Remove all horizontal lines and unnecessary borders */
hr {
    display: none !important;
    border: none !important;
    margin: 0 !important;
    padding: 0 !important;
    height: 0 !important;
}

/* Remove borders from all elements */
* {
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    outline: none !important;
    box-shadow: none !important;
}

/* Remove borders from specific elements that might be causing the issue */
.site-header, footer, .site-content, .container, 
.main-navigation, .sidebar, .widget, .course-thumbnail,
.post-thumbnail, .content, .comments-area, .comment-list,
.comment-form, .page-links, .tagcloud, .wp-block,
.entry-content, .entry-header, .entry-footer, .entry-summary {
    border: none !important;
    border-top: none !important;
    border-bottom: none !important;
    border-left: none !important;
    border-right: none !important;
}

/* Remove any pseudo-elements that might be adding lines */
::before, ::after {
    border: none !important;
    border-top: none !important;
    border-bottom: none !important;
    border-left: none !important;
    border-right: none !important;
}

/* Remove any background images that might look like lines */
body, .site-header, footer, .site-content, .container {
    background-image: none !important;
}

/* Remove any box-shadows that might look like lines */
body, .site-header, footer, .site-content, .container,
.main-navigation, .sidebar, .widget, .course-thumbnail,
.post-thumbnail, .content, .comments-area, .comment-list,
.comment-form, .page-links, .tagcloud, .wp-block,
.entry-content, .entry-header, .entry-footer, .entry-summary {
    box-shadow: none !important;
}

/* Remove any text-decoration that might look like lines */
a, a:hover, a:focus, a:active {
    text-decoration: none !important;
    border-bottom: none !important;
}

/* Remove any outlines */
:focus {
    outline: none !important;
    outline-width: 0 !important;
    outline-style: none !important;
    outline-color: transparent !important;
}

/* Fix for layout shifts when mobile menu is open */
body.menu-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
}

/* Header scroll effect */
.site-header.scrolled {
    background-color: #1e40af !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
}

/* Add these styles at the end of the file */
/* Auth page specific styles */
.login-page, .register-page {
    background-color: #f9fafb;
}

.login-page .site-content, .register-page .site-content {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 0;
}

.login-page .custom-auth-form, .register-page .custom-auth-form {
    background: #fff;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    padding: 2rem;
    width: 100%;
    max-width: 28rem;
}

.login-page .custom-auth-form h2, .register-page .custom-auth-form h2 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #1f2937;
    font-size: 1.5rem;
    font-weight: 700;
}

.login-page .auth-form .form-group, .register-page .auth-form .form-group {
    margin-bottom: 1.25rem;
}

.login-page .auth-form label, .register-page .auth-form label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #374151;
}

.login-page .auth-form input[type="text"],
.login-page .auth-form input[type="email"],
.login-page .auth-form input[type="password"],
.login-page .auth-form input[type="tel"],
.register-page .auth-form input[type="text"],
.register-page .auth-form input[type="email"],
.register-page .auth-form input[type="password"],
.register-page .auth-form input[type="tel"],
.register-page .auth-form textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    font-size: 1rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.login-page .auth-form input:focus,
.register-page .auth-form input:focus,
.register-page .auth-form textarea:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.login-page .auth-form .button, .register-page .auth-form .button {
    display: block;
    width: 100%;
    padding: 0.75rem;
    background-color: #1e40af;
    color: white;
    border: none;
    border-radius: 0.375rem;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.15s ease-in-out;
}

.login-page .auth-form .button:hover, .register-page .auth-form .button:hover {
    background-color: #1e3a8a;
}

.login-page .auth-links, .register-page .auth-links {
    text-align: center;
    margin-top: 1.5rem;
    color: #6b7280;
}

.login-page .auth-links a, .register-page .auth-links a {
    color: #1e40af;
    text-decoration: none;
    font-weight: 500;
}

.login-page .auth-links a:hover, .register-page .auth-links a:hover {
    text-decoration: underline;
}

.login-page .auth-message, .register-page .auth-message {
    margin-top: 1rem;
    padding: 0.75rem;
    border-radius: 0.375rem;
    text-align: center;
}

.login-page .error-message, .register-page .error-message {
    background-color: #fee;
    color: #c33;
    border: 1px solid #fcc;
}

/* Fix for z-index conflicts between preloader, header, and back-to-top */
#preloader {
    z-index: 99999 !important;
}

.site-header {
    z-index: 1000 !important;
}

#mobile-menu-sidebar {
    z-index: 9999 !important;
}

#mobile-menu-overlay {
    z-index: 9998 !important;
}

.back-to-top {
    z-index: 998 !important;
}

/* Ensure proper loading sequence for components */
body.preloader-active #preloader {
    display: flex !important;
}

body.preloader-active .site-header {
    opacity: 0.9;
}

body.preloader-active .back-to-top {
    display: none !important;
}

/* Prevent scroll jump when transparent header is initialized */
body {
    overflow-x: hidden;
}

.site-header {
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

/* Fix for transparent header causing scroll reset */
.header-transparent {
    will-change: background-color;
}

/* Ensure smooth transitions for all header states */
.site-header.sticky {
    position: sticky;
    top: 0;
    z-index: 999;
    width: 100%;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

/* Prevent layout shifts during initialization */
html, body {
    height: auto;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Add preloader class to body when preloader is active */
body.preloader-active {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
}

/* Sticky header styles */
.site-header.header-sticky-enabled {
    position: sticky;
    top: 0;
    z-index: 999;
    width: 100%;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    will-change: transform;
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

.site-header.scrolled {
    background-color: #1e40af !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
}

/* Prevent layout shifts when mobile menu is open */
body.mobile-menu-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
}